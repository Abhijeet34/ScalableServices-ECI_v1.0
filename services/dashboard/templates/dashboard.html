<!DOCTYPE html>
<html>
<head>
    <title>ECI Platform - Enterprise Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/styles/choices.min.css">
    <script src="https://cdn.jsdelivr.net/npm/choices.js@10.2.0/public/assets/scripts/choices.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1b2e 50%, #16213e 100%);
            color: #e2e8f0;
            overflow-x: hidden;
        }
        
        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 250, 198, 0.05) 0%, transparent 50%);
            animation: backgroundFlow 20s ease-in-out infinite;
            z-index: -1;
        }
        
        @keyframes backgroundFlow {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(0.5deg); }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #764ba2, #667eea);
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
            animation: slideDown 0.6s ease-out;
        }
        
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-title-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .dashboard-icon {
            width: 48px;
            height: 48px;
            flex-shrink: 0;
            filter: drop-shadow(0 4px 12px rgba(102, 126, 234, 0.4));
            transition: all 0.3s ease;
        }
        
        .dashboard-icon:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 6px 20px rgba(102, 126, 234, 0.6));
        }
        
        .header h1 { 
            font-size: 1.5rem; 
            font-weight: 700; 
            background: linear-gradient(135deg, #60a5fa, #a78bfa, #fb7185);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
            margin: 0;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: fadeInRight 0.8s ease-out 0.2s both;
        }
        
        @keyframes fadeInRight {
            from {
                transform: translateX(30px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .user-badge {
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.2), rgba(167, 139, 250, 0.2));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from {
                box-shadow: 0 0 5px rgba(96, 165, 250, 0.5);
            }
            to {
                box-shadow: 0 0 20px rgba(96, 165, 250, 0.8), 0 0 30px rgba(167, 139, 250, 0.4);
            }
        }
        .logout-btn {
            background: linear-gradient(135deg, rgba(248, 113, 113, 0.2), rgba(239, 68, 68, 0.2));
            border: 1px solid rgba(248, 113, 113, 0.3);
            color: #fca5a5;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        .logout-btn:hover {
            background: linear-gradient(135deg, rgba(248, 113, 113, 0.3), rgba(239, 68, 68, 0.3));
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(248, 113, 113, 0.4);
        }
        
        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            animation: fadeInUp 0.8s ease-out 0.3s both;
        }
        
        @keyframes fadeInUp {
            from {
                transform: translateY(40px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* Metrics Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .metric-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(51, 65, 85, 0.8));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            animation: scaleIn 0.6s ease-out both;
            animation-delay: calc(var(--i, 0) * 0.1s);
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.05), rgba(167, 139, 250, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .metric-card:hover::before {
            opacity: 1;
        }
        
        .metric-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(96, 165, 250, 0.2), 0 8px 32px rgba(0, 0, 0, 0.4);
            border-color: rgba(96, 165, 250, 0.4);
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        .metric-label {
            font-size: 0.875rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            font-weight: 600;
            position: relative;
            z-index: 2;
        }
        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
            z-index: 2;
            animation: countUp 1.5s ease-out;
        }
        
        @keyframes countUp {
            from {
                transform: scale(0.5);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        /* Tabs */
        .tabs {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(51, 65, 85, 0.9));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 2rem;
            overflow: hidden;
            animation: slideUp 0.8s ease-out 0.4s both;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes pulseAlert {
            0% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
            }
        }
        
        @keyframes pulseTransit {
            0% {
                box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(245, 158, 11, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(245, 158, 11, 0);
            }
        }
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
            overflow-x: auto;
            position: relative;
        }
        .tab-btn {
            padding: 1rem 1.5rem;
            border: none;
            background: none;
            color: #94a3b8;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            position: relative;
            overflow: hidden;
        }
        
        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(167, 139, 250, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .tab-btn:hover::before {
            opacity: 1;
        }
        
        .tab-btn:hover {
            color: #e2e8f0;
            transform: translateY(-2px);
        }
        
        .tab-btn.active {
            color: #60a5fa;
            border-bottom-color: #60a5fa;
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(167, 139, 250, 0.1));
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #60a5fa, #a78bfa);
            animation: slideInBottom 0.3s ease;
        }
        
        @keyframes slideInBottom {
            from {
                transform: scaleX(0);
            }
            to {
                transform: scaleX(1);
            }
        }
        .tab-content {
            display: none;
            padding: 2rem;
            content-visibility: auto;
            contain-intrinsic-size: auto 500px;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Data Table */
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .table-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #f1f5f9;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(102,126,234,0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }
        .btn-primary:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(245,101,101,0.3);
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245,101,101,0.4);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(66,153,225,0.3);
        }
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(66,153,225,0.4);
        }
        
        /* Card-based table rows */
        .data-grid {
            display: grid;
            gap: 1rem;
        }
        .data-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.6) 0%, rgba(51, 65, 85, 0.6) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 16px;
            padding: 1.75rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
            content-visibility: auto;
            contain-intrinsic-size: auto 200px;
        }
        .data-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #60a5fa 0%, #a78bfa 100%);
            opacity: 0;
            transition: opacity 0.4s;
        }
        .data-card:hover::before {
            opacity: 1;
        }
        .data-card:hover {
            box-shadow: 0 12px 32px rgba(96, 165, 250, 0.2), 0 4px 16px rgba(0, 0, 0, 0.4);
            transform: translateY(-4px) scale(1.01);
            border-color: rgba(96, 165, 250, 0.4);
        }
        .data-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        }
        .data-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }
        .data-card-id {
            font-size: 0.875rem;
            color: #60a5fa;
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.15) 0%, rgba(167, 139, 250, 0.15) 100%);
            padding: 0.35rem 0.85rem;
            border-radius: 24px;
            font-weight: 600;
            border: 1px solid rgba(96, 165, 250, 0.3);
        }
        .data-card-body {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        .data-field {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .data-label {
            font-size: 0.75rem;
            color: #e2e8f0;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .data-value {
            font-size: 1rem;
            color: #f1f5f9;
            font-weight: 600;
            letter-spacing: -0.01em;
        }
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
            min-width: 90px;
            text-align: center;
            border: 1px solid;
        }
        .status-created { background: rgba(59, 130, 246, 0.2); color: #93c5fd; border-color: rgba(59, 130, 246, 0.4); }
        .status-pending { background: rgba(251, 191, 36, 0.2); color: #fcd34d; border-color: rgba(251, 191, 36, 0.4); }
        .status-completed { background: rgba(34, 197, 94, 0.2); color: #86efac; border-color: rgba(34, 197, 94, 0.4); }
        .status-processing { background: rgba(168, 85, 247, 0.2); color: #c084fc; border-color: rgba(168, 85, 247, 0.4); }
        .status-shipped { background: rgba(14, 165, 233, 0.2); color: #7dd3fc; border-color: rgba(14, 165, 233, 0.4); }
        .status-delivered { background: rgba(34, 197, 94, 0.2); color: #86efac; border-color: rgba(34, 197, 94, 0.4); }
        .status-cancelled { background: rgba(239, 68, 68, 0.2); color: #fca5a5; border-color: rgba(239, 68, 68, 0.4); }
        .status-in_transit { background: rgba(14, 165, 233, 0.2); color: #7dd3fc; border-color: rgba(14, 165, 233, 0.4); }
        
        /* Service status cards */
        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        .service-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.6), rgba(51, 65, 85, 0.6));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            content-visibility: auto;
            contain-intrinsic-size: auto 150px;
        }
        .service-card:hover {
            box-shadow: 0 8px 24px rgba(96, 165, 250, 0.15);
            transform: translateY(-4px);
            border-color: rgba(96, 165, 250, 0.3);
        }
        .service-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .service-name {
            font-size: 1.125rem;
            font-weight: 700;
            color: #f1f5f9;
            text-transform: capitalize;
        }
        .service-status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            box-shadow: 0 0 8px currentColor;
            animation: breatheStatus 1.5s ease-in-out infinite;
        }
        
        @keyframes breatheStatus {
            0%, 100% {
                box-shadow: 0 0 8px currentColor;
                transform: scale(1);
            }
            50% {
                box-shadow: 0 0 16px currentColor;
                transform: scale(1.15);
            }
        }
        
        /* Scroll to Top Button */
        .scroll-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(100px);
        }
        
        .scroll-to-top.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .scroll-to-top:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.6);
            transform: translateY(-4px);
        }
        
        .scroll-to-top:active {
            transform: translateY(-2px);
        }
        
        .scroll-to-top svg {
            width: 24px;
            height: 24px;
            stroke: white;
            stroke-width: 2.5;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        
        /* Sticky Filters */
        .filters-container {
            position: sticky;
            top: 72px;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(51, 65, 85, 0.95));
            backdrop-filter: blur(20px);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            z-index: 100;
            border: 1px solid rgba(100, 116, 139, 0.3);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }
        
        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
            padding: 1rem;
        }
        
        .pagination-button {
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            color: #e2e8f0;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        .pagination-button:hover:not(:disabled) {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border-color: rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
        }
        
        .pagination-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .pagination-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-color: #667eea;
            box-shadow: 0 0 12px rgba(102, 126, 234, 0.5);
        }
        
        .pagination-info {
            color: #94a3b8;
            font-size: 0.875rem;
            padding: 0 1rem;
        }
        .service-metrics {
            display: grid;
            gap: 0.75rem;
        }
        .service-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
        }
        .service-metric-label {
            color: #cbd5e0;
        }
        .service-metric-value {
            color: #f1f5f9;
            font-weight: 600;
        }
        
        /* Greeting */
        .greeting {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #60a5fa, #a78bfa, #fb7185);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            animation: fadeInUp 0.6s ease-out 0.2s both;
        }
        .greeting-subtitle {
            color: #94a3b8;
            font-size: 1.125rem;
            margin-bottom: 2rem;
            animation: fadeInUp 0.6s ease-out 0.3s both;
        }
        
        /* Activity Feed */
        .activity-feed {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.6), rgba(51, 65, 85, 0.6));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 8px;
            padding: 1.5rem;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .activity-user-group {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .activity-user-group:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.5) !important;
        }
        
        .activity-entry {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .activity-entry:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(96, 165, 250, 0.25);
        }
        
        .activity-details {
            display: none;
            margin-top: 0.75rem;
            padding: 1rem;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            animation: slideDown 0.3s ease-out;
        }
        
        .activity-details.active {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .detail-section {
            margin-bottom: 1rem;
        }
        
        .detail-section:last-child {
            margin-bottom: 0;
        }
        
        .detail-label {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .detail-content {
            background: rgba(15, 23, 42, 0.6);
            padding: 0.75rem;
            border-radius: 6px;
            border: 1px solid rgba(100, 116, 139, 0.2);
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.8rem;
            color: #cbd5e0;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .detail-content pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .activity-item {
            padding: 1rem;
            border-left: 3px solid rgba(100, 116, 139, 0.4);
            margin-bottom: 1rem;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 4px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .activity-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(96, 165, 250, 0.2);
        }
        .activity-item.create {
            border-left-color: #48bb78;
        }
        .activity-item.update {
            border-left-color: #4299e1;
        }
        .activity-item.delete {
            border-left-color: #f56565;
        }
        .activity-time {
            font-size: 0.75rem;
            color: #94a3b8;
        }
        .activity-text {
            margin-top: 0.25rem;
            color: #e2e8f0;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.98), rgba(51, 65, 85, 0.98));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 16px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #94a3b8;
            transition: color 0.2s ease;
        }
        .close-btn:hover {
            color: #f87171;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #e2e8f0;
            position: relative;
            font-size: 0.875rem;
        }
        .required-asterisk {
            color: #f56565;
            margin-left: 4px;
            font-weight: 700;
            cursor: help;
            position: relative;
        }
        .required-asterisk:hover::after {
            content: 'Required field';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: #2d3748;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            z-index: 1000;
            font-weight: 500;
        }
        .form-input, select.form-input {
            width: 100%;
            padding: 0.75rem;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 8px;
            font-size: 1rem;
            color: #e2e8f0;
            transition: all 0.3s ease;
        }
        
        select.form-input {
            height: auto;
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* Choices.js Dark Theme */
        .choices.choices-dark {
            margin-bottom: 0;
            flex: 1;
            min-width: 0;
        }
        .choices.choices-dark .choices__inner {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 8px;
            padding: 0.5rem 0.75rem;
            color: #e2e8f0;
            min-height: 44px;
        }
        .choices.choices-dark.is-focused .choices__inner {
            border-color: #60a5fa;
            background: rgba(15, 23, 42, 0.7);
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
        .choices.choices-dark .choices__list--dropdown {
            background: rgba(15, 23, 42, 0.98);
            border: 1px solid rgba(100, 116, 139, 0.4);
            border-radius: 8px;
            margin-top: 4px;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        .choices.choices-dark .choices__list--dropdown .choices__item {
            color: #e2e8f0;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
        }
        .choices.choices-dark .choices__list--dropdown .choices__item--selectable.is-highlighted {
            background: rgba(96, 165, 250, 0.2);
            color: #f1f5f9;
        }
        .choices.choices-dark .choices__item--disabled {
            color: #64748b;
        }
        .choices.choices-dark .choices__input {
            background: transparent;
            color: #e2e8f0;
            padding: 0.25rem 0;
        }
        .choices.choices-dark .choices__input::placeholder {
            color: #64748b;
        }
        .choices.choices-dark .choices__placeholder {
            color: #64748b;
            opacity: 1;
        }
        
        .form-input::placeholder {
            color: #64748b;
        }
        .form-input:focus {
            outline: none;
            border-color: #60a5fa;
            background: rgba(15, 23, 42, 0.7);
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1);
        }
        
        /* Messages */
        .message {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
        }
        .message.success {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #4ade80;
        }
        .message.error {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #f87171;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #94a3b8;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #94a3b8;
            font-size: 1rem;
        }
        
        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 50%, #4a5568 100%);
            position: relative;
            overflow: hidden;
        }
        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102,126,234,0.1) 0%, transparent 70%);
            animation: pulse 15s ease-in-out infinite;
        }
        
        /* DevOps Background Icons */
        .devops-background {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.15;
            overflow: hidden;
        }
        
        .devops-icon {
            position: absolute;
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(5deg); }
            66% { transform: translateY(20px) rotate(-5deg); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        .login-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 25px 70px rgba(0,0,0,0.4), 0 0 0 1px rgba(255,255,255,0.1);
            width: 100%;
            max-width: 420px;
            position: relative;
            z-index: 1;
        }
        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }
        .login-logo-icon {
            width: 100px;
            height: 100px;
            background: transparent;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            position: relative;
            animation: rocketBoost 3s ease-in-out infinite;
        }
        
        @keyframes rocketBoost {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            10% {
                transform: translateY(-5px) rotate(-2deg);
            }
            20% {
                transform: translateY(0) rotate(2deg);
            }
            30% {
                transform: translateY(-8px) rotate(-3deg);
            }
            40% {
                transform: translateY(-15px) rotate(0deg);
            }
            50% {
                transform: translateY(-20px) rotate(0deg);
            }
            60% {
                transform: translateY(-15px) rotate(0deg);
            }
            70% {
                transform: translateY(-8px) rotate(3deg);
            }
            80% {
                transform: translateY(0) rotate(-2deg);
            }
            90% {
                transform: translateY(-3px) rotate(0deg);
            }
        }
        .login-title {
            font-size: 1.75rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .login-subtitle {
            text-align: center;
            color: #475569;
            font-size: 0.875rem;
            margin-bottom: 2rem;
            font-weight: 500;
        }
        .user-hint {
            margin-top: 1.5rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-radius: 10px;
            font-size: 0.875rem;
            border: 1px solid #cbd5e0;
            color: #334155;
            line-height: 1.6;
        }
        .user-hint strong {
            color: #667eea;
            font-weight: 700;
        }
        
        /* Login Form Specific Overrides */
        #loginForm .form-input {
            background: #f8fafc;
            border: 1px solid #cbd5e0;
            color: #1e293b;
        }
        
        #loginForm .form-input::placeholder {
            color: #94a3b8;
        }
        
        #loginForm .form-input:focus {
            border-color: #667eea;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        #loginForm .form-label {
            color: #1e293b;
            font-weight: 600;
        }
        
        /* Admin Notifications Widget */
        .admin-notifications {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.08), rgba(245, 158, 11, 0.08));
            border: 1px solid rgba(251, 146, 60, 0.2);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 16px rgba(245, 158, 11, 0.15);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            opacity: 1;
            max-height: 500px;
            transition: opacity 0.5s ease-out, max-height 0.5s ease-out, margin-bottom 0.5s ease-out;
        }
        
        .admin-notifications.fade-out {
            opacity: 0;
            max-height: 0;
            margin-bottom: 0;
            padding-top: 0;
            padding-bottom: 0;
        }
        
        .admin-notifications::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, rgba(251, 146, 60, 0.6), rgba(245, 158, 11, 0.6));
            border-radius: 16px 0 0 16px;
        }
        .admin-notifications-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        .admin-notifications-title {
            font-size: 1rem;
            font-weight: 700;
            color: #f59e0b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .admin-notifications-badge {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
            animation: buzzPulse 3s ease-in-out infinite;
        }
        
        @keyframes buzzPulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
            }
            10% {
                transform: scale(1.15) rotate(-3deg);
                box-shadow: 0 4px 16px rgba(239, 68, 68, 0.6);
            }
            15% {
                transform: scale(1.1) rotate(3deg);
                box-shadow: 0 4px 16px rgba(239, 68, 68, 0.6);
            }
            20% {
                transform: scale(1.15) rotate(-3deg);
                box-shadow: 0 4px 16px rgba(239, 68, 68, 0.6);
            }
            25% {
                transform: scale(1.1) rotate(3deg);
                box-shadow: 0 4px 16px rgba(239, 68, 68, 0.6);
            }
            30% {
                transform: scale(1.15) rotate(-2deg);
                box-shadow: 0 4px 16px rgba(239, 68, 68, 0.6);
            }
            35% {
                transform: scale(1) rotate(0deg);
                box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
            }
        }
        
        .admin-notifications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.25rem;
        }
        .admin-notification-item {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(251, 191, 36, 0.15);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .admin-notification-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #fbbf24, #f59e0b);
        }
        
        .admin-notification-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(251, 191, 36, 0.15);
            border-color: rgba(251, 191, 36, 0.25);
        }
        
        .admin-notification-count {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            line-height: 1;
        }
        .admin-notification-label {
            font-size: 0.875rem;
            color: #f1f5f9;
            font-weight: 600;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginContainer" class="login-container">
        <!-- DevOps Background Icons - Real Tool Logos -->
        <div class="devops-background">
            <!-- Docker Official Logo -->
            <svg class="devops-icon" style="top: 8%; left: 8%; width: 110px; animation-delay: 0s;" viewBox="0 0 24 24" fill="#8fb5d9">
                <path d="M13.983 11.078h2.119a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.119a.185.185 0 00-.185.185v1.888c0 .102.083.185.185.185m-2.954-5.43h2.118a.186.186 0 00.186-.186V3.574a.186.186 0 00-.186-.185h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.185m0 2.716h2.118a.187.187 0 00.186-.186V6.29a.186.186 0 00-.186-.185h-2.118a.185.185 0 00-.185.185v1.887c0 .102.082.185.185.186m-2.93 0h2.12a.186.186 0 00.184-.186V6.29a.185.185 0 00-.185-.185H8.1a.185.185 0 00-.185.185v1.887c0 .102.083.185.185.186m-2.964 0h2.119a.186.186 0 00.185-.186V6.29a.185.185 0 00-.185-.185H5.136a.186.186 0 00-.186.185v1.887c0 .102.084.185.186.186m5.893 2.715h2.118a.186.186 0 00.186-.185V9.006a.186.186 0 00-.186-.186h-2.118a.185.185 0 00-.185.185v1.888c0 .102.082.185.185.185m-2.93 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.185.185 0 00-.184.185v1.888c0 .102.083.185.185.185m-2.964 0h2.119a.185.185 0 00.185-.185V9.006a.185.185 0 00-.184-.186h-2.12a.186.186 0 00-.186.186v1.887c0 .102.084.185.186.185m-2.92 0h2.12a.185.185 0 00.184-.185V9.006a.185.185 0 00-.184-.186h-2.12a.185.185 0 00-.184.185v1.888c0 .102.082.185.185.185M23.763 9.89c-.065-.051-.672-.51-1.954-.51-.338.001-.676.03-1.01.087-.248-1.7-1.653-2.53-1.716-2.566l-.344-.199-.226.327c-.284.438-.49.922-.612 1.43-.23.97-.09 1.882.403 2.661-.595.332-1.55.413-1.744.42H.751a.751.751 0 00-.75.748 11.376 11.376 0 00.692 4.062c.545 1.428 1.355 2.48 2.41 3.124 1.18.723 3.1 1.137 5.275 1.137.983.003 1.963-.086 2.93-.266a12.248 12.248 0 003.823-1.389c.98-.567 1.86-1.288 2.61-2.136 1.252-1.418 1.998-2.997 2.553-4.4h.221c1.372 0 2.215-.549 2.68-1.009.309-.293.55-.65.707-1.046l.098-.288z"/>
            </svg>
            
            <!-- Kubernetes Official Logo -->
            <svg class="devops-icon" style="top: 65%; left: 10%; width: 95px; animation-delay: 2s;" viewBox="0 0 24 24" fill="#9ab8d9">
                <path d="M12 2.28l-.421.141L2.36 6.26l-.268.39-.082.39v7.734l.082.39.268.39 9.219 4.04.421.141.421-.141 9.22-4.04.267-.39.082-.39V7.04l-.082-.39-.268-.39-9.219-4.04zm.749 1.476v2.928c.403.067.79.187 1.158.36l2.07-2.07zm-1.496 0l-1.94 1.94 2.069 2.069c.368-.173.756-.293 1.158-.36V3.756zM7.623 5.389l-1.94 1.94 2.34.78c.038-.421.142-.827.31-1.205zM16.377 5.39L14.69 7.08c.167.378.27.784.309 1.205l2.339-.78zM4.2 7.993v2.744l2.027-.675a4.979 4.979 0 01-.309-1.394zm15.6 0l-1.718.575a4.979 4.979 0 01-.309 1.394l2.027.675zm-13.562.85l-2.34.78 1.94 1.94c.167-.378.27-.784.308-1.205zm11.524 0l-1.226 1.515c.038.421.141.827.309 1.205l1.94-1.94zM12 9.031c-1.116 0-2.023.907-2.023 2.023 0 1.116.907 2.023 2.023 2.023 1.116 0 2.023-.907 2.023-2.023 0-1.116-.907-2.023-2.023-2.023zm-3.644.626l-2.027.674v2.745l2.027-.674a4.979 4.979 0 010-2.745zm7.288 0a4.979 4.979 0 010 2.745l2.027.674v-2.745zm-5.26.52l-2.14 2.14 2.341.78c-.038-.42-.038-.845 0-1.266-.168-.378-.272-.784-.31-1.206zm3.232 0c-.037.422-.141.828-.309 1.206.038.421.038.846 0 1.266l2.34-.78zm-1.616.64l-.001.02.001.032v.061c0 .064.01.123.02.184v.061l.02.082.001.06c.01.032.02.062.031.093l.021.061.031.082c.011.031.021.061.041.082l.021.061.041.082c.011.031.031.061.041.082l.031.061.041.082.051.072.031.051.051.082.051.061.041.061.051.061.051.062.051.061.051.061.062.062.051.051.062.061.061.051.062.062.061.051.062.051.072.051.061.051h.061l.082.051.061.041.082.041.072.031.082.041.082.031.082.041h.082l.082.03.082.021.092.021h.082l.092.02h.092l.092.021h.102l.093.01.092.011h.113l.113-.01h.113l.103-.011.102-.01h.103l.092-.021h.093l.092-.021.092-.02.082-.021.093-.031.082-.03h.082l.082-.031.082-.041.082-.031.082-.041.082-.041h.061l.082-.051.072-.051.072-.051.061-.051.062-.051.071-.062.051-.061.062-.051.061-.062.062-.061.051-.062.051-.061.051-.061.051-.061.051-.062.041-.061.041-.061.051-.072.041-.082.031-.061.041-.082.041-.082.031-.061.031-.082.02-.061c.011-.031.011-.051.021-.082v-.062c.011-.03.021-.06.021-.082v-.061c.01-.061.02-.123.02-.185v-.061l.011-.031V11.075l-.011-.031v-.062c0-.061-.01-.123-.02-.184v-.061l-.021-.082v-.062l-.02-.082-.011-.06-.031-.083-.02-.061c-.011-.031-.021-.061-.031-.093l-.021-.06-.031-.083-.041-.082-.021-.061-.041-.082-.041-.082-.031-.061-.041-.082-.051-.071-.031-.052-.051-.082-.051-.061-.041-.061-.051-.061-.051-.062-.051-.061-.051-.061-.062-.061-.051-.052-.062-.061-.061-.051-.062-.062-.061-.051-.062-.051-.072-.051-.061-.051h-.061l-.082-.051-.061-.041-.082-.041-.072-.031-.082-.041-.082-.03-.082-.041h-.082l-.082-.031-.082-.021-.092-.02h-.082l-.092-.021h-.092l-.092-.021h-.102l-.093-.01H12.268l-.113.01h-.103l-.092.011-.102.01h-.093l-.092.02h-.092l-.093.021-.092.021-.082.03-.093.031-.082.03h-.082l-.082.031-.082.041-.082.031-.082.041-.082.041h-.061l-.082.051-.072.051-.072.051-.061.051-.062.051-.071.062-.051.061-.062.051-.061.062-.062.061-.051.062-.051.061-.051.061-.051.061-.051.062-.041.061-.041.061-.051.072-.041.082-.031.061-.041.082-.041.082-.031.061-.031.082-.02.061-.031.082v.062l-.02.082v.061c-.011.061-.021.123-.021.185v.061l-.01.031v.04zM12 12.536c.402 0 .732.33.732.732a.734.734 0 01-.732.732.734.734 0 01-.732-.732c0-.402.33-.732.732-.732zM9.644 14.43c.038.421.142.827.31 1.205l-2.07 2.07 1.94 1.94.78-2.34a4.979 4.979 0 01-1.158-.36zm4.712 0l-1.515 1.226c.402.066.79.186 1.158.359l.78 2.34 1.94-1.94zm-7.058.78l-2.027.675v2.744l1.718-.575c.038-.421.141-.827.309-1.205zm9.404 0c.167.378.27.784.309 1.205l1.718.575v-2.744zM12 15.695v2.928l1.228-.411-1.228-3.675c-.403.103-.826.103-1.228 0l-1.228 3.675z"/>
            </svg>
            
            <!-- GitHub Logo -->
            <svg class="devops-icon" style="top: 15%; right: 10%; width: 90px; animation-delay: 4s;" viewBox="0 0 24 24" fill="#94a3b8">
                <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
            </svg>
            
            <!-- Jenkins Logo -->
            <svg class="devops-icon" style="top: 55%; right: 8%; width: 100px; animation-delay: 6s;" viewBox="0 0 24 24" fill="#8f9ba8">
                <path d="M11.5525.3697c.3024-.0476.6048-.0799.9048-.1026.103-.008.206-.0113.309-.0162.3658-.017.7325-.0294 1.0992.003.4407.039.8798.1155 1.3074.2435.6582.1979 1.2857.4944 1.8548.8759.5706.3817 1.08.842 1.5092 1.3597.2146.2589.4098.5317.5858.8174.176.2857.3316.5846.4645.8944.0665.155.1297.311.1879.4686.0582.1576.1114.3168.1597.4775.0966.3214.1734.6477.2305.9772.0571.3295.0944.6624.1119.9952.0175.3328.0153.6665-.0073.9984-.0226.332-.0652.6633-.1276.9911-.0624.3278-.1447.6522-.2467.9698-.102.3176-.2237.6286-.3648.9287-.1411.3-.303.5892-.484.8644-.181.2752-.3813.5365-.5999.7803-.2186.2438-.4556.4701-.7106.6756-.255.2055-.528.391-.8157.555-.2877.164-.5901.3079-.9024.4296-.3123.1217-.6345.2212-.9616.2983-.3271.0771-.6591.1318-1.0008.1641-.3417.0323-.6932.0422-1.0742.0294-.3809-.0128-.787-.0461-1.2065-.1061-.8389-.1199-1.6811-.3453-2.4634-.7308-.3911-.1927-.7622-.4296-1.1022-.7036-.34-.274-.6489-.5852-.9229-.9256-.274-.3404-.5131-.7099-.7122-1.0992-.199-.3893-.3579-.7976-.4744-1.2147-.0583-.2085-.1083-.4188-.1501-.6307-.0418-.212-.0754-.4258-.1009-.6412-.0255-.2154-.042-.4324-.0502-.6502-.0082-.2178-.0081-.4363.0016-.6547.0097-.2184.0311-.4367.0641-.6542.033-.2175.0776-.4342.1338-.649.0562-.2148.1239-.4277.2032-.638.159-.4208.3666-.824.6174-1.2049.2508-.3809.5449-.735.8775-1.0537.3326-.3187.7037-.6019 1.1084-.8441.4047-.2422.8429-.4434 1.3073-.5953.4644-.1519.9553-.254 1.4609-.3034.5056-.0494 1.0259-.0461 1.5494.0049z"/>
            </svg>
            
            <!-- GitLab Logo -->
            <svg class="devops-icon" style="top: 35%; left: 85%; width: 85px; animation-delay: 8s;" viewBox="0 0 24 24" fill="#a0aec0">
                <path d="M23.6004 9.5927l-.0337-.0862L20.3.9814a.851.851 0 00-.3362-.405.8748.8748 0 00-.9997.0539.8748.8748 0 00-.29.4399l-2.2055 6.748H7.5375l-2.2057-6.748a.8573.8573 0 00-.29-.4412.8748.8748 0 00-.9997-.0537.8585.8585 0 00-.3362.4049L.4332 9.5015l-.0325.0862a6.0657 6.0657 0 002.0119 7.0062l.0113.0087.03.0213 4.976 3.7264 2.462 1.8633 1.4995 1.1321a1.0085 1.0085 0 001.2197 0l1.4995-1.1321 2.4619-1.8633 5.006-3.7489.0125-.01a6.0682 6.0682 0 002.0094-7.003z"/>
            </svg>
            
            <!-- Terraform Logo -->
            <svg class="devops-icon" style="top: 10%; left: 50%; width: 95px; animation-delay: 10s;" viewBox="0 0 24 24" fill="#8fa0b3">
                <path d="M15.937 1.633v8.188l7.087-4.094V1.633h-7.087zm-1.875 0H6.975v8.188l7.087-4.094V1.633zM6.975 12.467v8.188l7.087-4.094v-8.188l-7.087 4.094zm8.962 0v8.188l7.087-4.094v-8.188l-7.087 4.094zM.85 6.539v8.188l7.087-4.094V6.539L.85 6.539z"/>
            </svg>
            
            <!-- Prometheus Logo -->
            <svg class="devops-icon" style="top: 68%; right: 15%; width: 90px; animation-delay: 12s;" viewBox="0 0 24 24" fill="#94a8ba">
                <path d="M12.00 2.73c-4.98 0-9.27 4.29-9.27 9.27s4.29 9.27 9.27 9.27 9.27-4.29 9.27-9.27-4.29-9.27-9.27-9.27zm0 16.68c-4.08 0-7.41-3.33-7.41-7.41S7.92 4.59 12.00 4.59s7.41 3.33 7.41 7.41-3.33 7.41-7.41 7.41zm.48-11.64h-.96v4.8l4.08 2.43.48-.78-3.6-2.13V7.77z"/>
            </svg>
            
            <!-- Redis Logo -->
            <svg class="devops-icon" style="top: 40%; left: 5%; width: 85px; animation-delay: 14s;" viewBox="0 0 24 24" fill="#a8b5c2">
                <path d="M10.5 2.661l.54.997-1.797.644 2.409.218.748 1.246.467-1.121 2.077-.208-1.61-.613.426-1.017-1.578.519zm6.905 2.077L13.76 6.182l3.292 1.298.353-.146 3.293-1.298zm-10.51.312L3.6 6.494l3.293 1.298 3.293-1.298zm5.255.156l-3.146 1.298 3.146 1.298 3.146-1.298zm8.71.312v2.077l3.146 1.298v-2.077zm-17.42.156v1.92l3.146 1.3v-1.921zm4.507 0v1.92l3.146 1.3v-1.921zm4.507 0v1.92l3.146 1.3v-1.921zm-9.014.312v1.763l3.146 1.298v-1.763zm4.507 0v1.763l3.146 1.298v-1.763zm4.507 0v1.763l3.146 1.298v-1.763zM24 10.5l-3.293-1.298-3.293 1.298 3.293 1.298zm-4.651.312l-3.146-1.298L13.06 10.81l3.146 1.298zm-4.507 0l-3.146-1.298L8.553 10.81l3.146 1.298zM3.6 10.812l-3.293-1.298-3.293 1.298 3.293 1.298z"/>
            </svg>
        </div>
        
        <div class="login-card">
            <div class="login-logo">
                <div class="login-logo-icon">
                    <svg width="90" height="90" viewBox="0 0 90 90">
                        <!-- Rocket Body -->
                        <g style="filter: drop-shadow(0 8px 16px rgba(102, 126, 234, 0.4));">
                            <path d="M 45 10 L 55 30 L 55 60 L 50 70 L 40 70 L 35 60 L 35 30 Z" 
                                  fill="url(#rocketGradient)" stroke="#667eea" stroke-width="2"/>
                            <!-- Window -->
                            <circle cx="45" cy="35" r="6" fill="#764ba2" opacity="0.8"/>
                            <circle cx="45" cy="35" r="4" fill="#a78bfa" opacity="0.6"/>
                            
                            <!-- Fins -->
                            <path d="M 35 55 L 25 70 L 35 65 Z" fill="#667eea" stroke="#667eea" stroke-width="1.5"/>
                            <path d="M 55 55 L 65 70 L 55 65 Z" fill="#667eea" stroke="#667eea" stroke-width="1.5"/>
                            
                            <!-- Nose Cone -->
                            <path d="M 45 5 L 55 30 L 35 30 Z" fill="#764ba2" stroke="#667eea" stroke-width="2"/>
                        </g>
                        
                        <!-- Animated Flames -->
                        <g style="animation: flicker 0.3s ease-in-out infinite alternate;">
                            <path d="M 40 70 L 38 78 L 42 75 L 40 82 L 43 75 L 45 82 L 47 75 L 50 82 L 48 75 L 52 78 L 50 70 Z" 
                                  fill="url(#flameGradient)" opacity="0.9"/>
                            <path d="M 42 70 L 40 75 L 43 73 L 45 78 L 47 73 L 50 75 L 48 70 Z" 
                                  fill="#fbbf24" opacity="0.7"/>
                        </g>
                        
                        <!-- Smoke Particles -->
                        <circle cx="42" cy="85" r="3" fill="#94a3b8" opacity="0.3" style="animation: smoke1 2s ease-out infinite;"/>
                        <circle cx="48" cy="83" r="2.5" fill="#94a3b8" opacity="0.25" style="animation: smoke2 2.2s ease-out infinite;"/>
                        <circle cx="45" cy="87" r="2" fill="#94a3b8" opacity="0.2" style="animation: smoke3 1.8s ease-out infinite;"/>
                        
                        <defs>
                            <linearGradient id="rocketGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="flameGradient" x1="50%" y1="0%" x2="50%" y2="100%">
                                <stop offset="0%" style="stop-color:#f59e0b;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#ef4444;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#dc2626;stop-opacity:0.8" />
                            </linearGradient>
                        </defs>
                    </svg>
                    
                    <style>
                        @keyframes flicker {
                            from { transform: scaleY(1) translateY(0); }
                            to { transform: scaleY(0.9) translateY(2px); }
                        }
                        @keyframes smoke1 {
                            0% { transform: translate(0, 0) scale(1); opacity: 0.3; }
                            100% { transform: translate(-5px, 15px) scale(1.5); opacity: 0; }
                        }
                        @keyframes smoke2 {
                            0% { transform: translate(0, 0) scale(1); opacity: 0.25; }
                            100% { transform: translate(5px, 18px) scale(1.8); opacity: 0; }
                        }
                        @keyframes smoke3 {
                            0% { transform: translate(0, 0) scale(1); opacity: 0.2; }
                            100% { transform: translate(0, 20px) scale(2); opacity: 0; }
                        }
                    </style>
                </div>
                <h2 class="login-title">ECI Platform</h2>
                <p class="login-subtitle">Enterprise Command & Intelligence Dashboard</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" style="color: #1e293b; font-weight: 600;">Username</label>
                    <input type="text" id="username" class="form-input" style="background: #f8fafc; border: 1px solid #cbd5e0; color: #1e293b;" required autocomplete="username" placeholder="Enter username">
                </div>
                <div class="form-group">
                    <label class="form-label" style="color: #1e293b; font-weight: 600;">Password</label>
                    <input type="password" id="password" class="form-input" style="background: #f8fafc; border: 1px solid #cbd5e0; color: #1e293b;" required autocomplete="current-password" placeholder="Enter password">
                </div>
                <button type="submit" class="btn-primary" style="width: 100%;">Sign In</button>
            </form>
            <div id="loginError" class="message error" style="display:none;"></div>
            <div class="user-hint">
                <strong>Demo Accounts</strong><br>
                <span style="margin-top: 0.5rem; display: block;"><strong>Admin:</strong> admin / admin123</span>
                <span style="display: block;"><strong>Guest:</strong> guest / guest123</span>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardContainer" style="display:none;">
        <div class="header">
            <div class="header-content">
                <div class="header-title-group">
                    <svg class="dashboard-icon" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="logoGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="logoGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#60a5fa;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#a78bfa;stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        
                        <!-- Outer ring -->
                        <circle cx="24" cy="24" r="20" fill="none" stroke="url(#logoGrad1)" stroke-width="2" opacity="0.4">
                            <animate attributeName="r" values="20;22;20" dur="2s" repeatCount="indefinite"/>
                        </circle>
                        
                        <!-- Main circle -->
                        <circle cx="24" cy="24" r="18" fill="url(#logoGrad1)" opacity="0.9"/>
                        
                        <!-- Chart bars -->
                        <rect x="12" y="20" width="4" height="12" rx="2" fill="#60a5fa" opacity="0.9">
                            <animate attributeName="height" values="12;16;12" dur="1.5s" repeatCount="indefinite"/>
                            <animate attributeName="y" values="20;16;20" dur="1.5s" repeatCount="indefinite"/>
                        </rect>
                        <rect x="18" y="14" width="4" height="18" rx="2" fill="#a78bfa" opacity="0.9">
                            <animate attributeName="height" values="18;22;18" dur="1.8s" repeatCount="indefinite"/>
                            <animate attributeName="y" values="14;10;14" dur="1.8s" repeatCount="indefinite"/>
                        </rect>
                        <rect x="24" y="18" width="4" height="14" rx="2" fill="#fb7185" opacity="0.9">
                            <animate attributeName="height" values="14;18;14" dur="1.6s" repeatCount="indefinite"/>
                            <animate attributeName="y" values="18;14;18" dur="1.6s" repeatCount="indefinite"/>
                        </rect>
                        <rect x="30" y="16" width="4" height="16" rx="2" fill="#fbbf24" opacity="0.9">
                            <animate attributeName="height" values="16;20;16" dur="1.7s" repeatCount="indefinite"/>
                            <animate attributeName="y" values="16;12;16" dur="1.7s" repeatCount="indefinite"/>
                        </rect>
                        
                        <!-- Trend line -->
                        <polyline points="12,28 18,22 24,24 30,18 36,20" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" opacity="0.8">
                            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite"/>
                        </polyline>
                        
                        <!-- Sparkle effects -->
                        <circle cx="14" cy="10" r="1.5" fill="#fff" opacity="0.8">
                            <animate attributeName="opacity" values="0.8;0.2;0.8" dur="1.5s" repeatCount="indefinite"/>
                        </circle>
                        <circle cx="34" cy="12" r="1.5" fill="#fff" opacity="0.6">
                            <animate attributeName="opacity" values="0.6;0.1;0.6" dur="2s" repeatCount="indefinite"/>
                        </circle>
                    </svg>
                    <h1>ECI Enterprise Dashboard</h1>
                </div>
                <div class="user-info">
                    <span id="userName"></span>
                    <span class="user-badge" id="userRole"></span>
                    <button class="logs-header-btn" onclick="toggleLogsDrawer()" title="Activity Logs">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        <span>Logs</span>
                        <span id="logsHeaderBadge" class="logs-header-badge">0</span>
                    </button>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Greeting -->
            <div class="greeting" id="greeting">Welcome back!</div>
            <div class="greeting-subtitle" id="greetingSubtitle">Here's what's happening with your services</div>
            
            <!-- Metrics Cards -->
            <div class="metrics-grid">
                <div class="metric-card" style="--i: 0">
                    <div class="metric-label">Total Orders</div>
                    <div class="metric-value" id="totalOrders">0</div>
                </div>
                <div class="metric-card" style="--i: 1">
                    <div class="metric-label">Total Customers</div>
                    <div class="metric-value" id="totalCustomers">0</div>
                </div>
                <div class="metric-card" style="--i: 2">
                    <div class="metric-label">Total Products</div>
                    <div class="metric-value" id="totalProducts">0</div>
                </div>
                <div class="metric-card" style="--i: 3">
                    <div class="metric-label">Active Services</div>
                    <div class="metric-value" id="activeServices">0/7</div>
                </div>
            </div>
            
            <!-- Admin Notifications Widget (Admin Only) -->
                <div id="adminNotifications" class="admin-notifications" style="display: none;">
                <div class="admin-notifications-header">
                    <div class="admin-notifications-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        Action Items
                        <span id="guestActionNotice" style="display: none; margin-left: 0.5rem; font-size: 0.75rem; color: #fbbf24; font-weight: 600;">(To be performed by Admin User!)</span>
                    </div>
                    <div class="admin-notifications-badge" id="totalActionItems">0</div>
                </div>
                <div class="admin-notifications-grid">
                    <div class="admin-notification-item">
                        <div class="admin-notification-count" id="pendingPaymentsCount">0</div>
                        <div class="admin-notification-label">Pending Payment Approvals</div>
                    </div>
                    <div class="admin-notification-item">
                        <div class="admin-notification-count" id="readyToShipCount">0</div>
                        <div class="admin-notification-label">Orders Ready to Ship</div>
                    </div>
                    <div class="admin-notification-item">
                        <div class="admin-notification-count" id="inTransitCount">0</div>
                        <div class="admin-notification-label">Shipments In Transit</div>
                    </div>
                </div>
            </div>

            <!-- Tabbed Content -->
            <div class="tabs">
                <div class="tab-buttons">
                    <button class="tab-btn active" onclick="switchTab('overview')">Overview</button>
                    <button class="tab-btn" onclick="switchTab('customers')">Customers</button>
                    <button class="tab-btn" onclick="switchTab('products')">Products</button>
                    <button class="tab-btn" onclick="switchTab('orders')">Orders</button>
                    <button class="tab-btn" onclick="switchTab('shipments')">Shipments</button>
                    <button class="tab-btn" onclick="switchTab('activity')">Activity Feed</button>
                </div>

                <!-- Overview Tab -->
                <div id="tab-overview" class="tab-content active">
                    <h3 class="table-title">Service Health & Uptime</h3>
                    <div id="servicesStatus" class="service-grid"></div>
                </div>

                <!-- Customers Tab -->
                <div id="tab-customers" class="tab-content">
                    <div class="table-header">
                        <h3 class="table-title">Customers</h3>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <select id="customerSortBy" class="form-input" style="width: 200px;" onchange="sortAndDisplayCustomers()">
                                <option value="id-desc">Sort: Newest First</option>
                                <option value="id-asc">Sort: Oldest First</option>
                                <option value="name-asc">Sort: Name (A-Z)</option>
                                <option value="name-desc">Sort: Name (Z-A)</option>
                            </select>
                            <button class="btn-primary" id="addCustomerBtn" onclick="showCreateCustomerModal()">
                                + Add Customer
                            </button>
                        </div>
                    </div>
                    <div id="customersTable"></div>
                </div>

                <!-- Products Tab -->
                <div id="tab-products" class="tab-content">
                    <div class="table-header">
                        <h3 class="table-title">Products</h3>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <select id="productSortBy" class="form-input" style="width: 220px;" onchange="sortAndDisplayProducts()">
                                <option value="id-desc">Sort: Newest First</option>
                                <option value="id-asc">Sort: Oldest First</option>
                                <option value="name-asc">Sort: Name (A-Z)</option>
                                <option value="name-desc">Sort: Name (Z-A)</option>
                                <option value="price-asc">Sort: Price (Low-High)</option>
                                <option value="price-desc">Sort: Price (High-Low)</option>
                                <option value="stock-asc">Sort: Stock (Low-High)</option>
                                <option value="stock-desc">Sort: Stock (High-Low)</option>
                            </select>
                            <button class="btn-primary" id="addProductBtn" onclick="showCreateProductModal()">
                                + Add Product
                            </button>
                        </div>
                    </div>
                    <div id="productsTable"></div>
                </div>

                <!-- Orders Tab -->
                <div id="tab-orders" class="tab-content">
                    <div class="table-header">
                        <h3 class="table-title">Orders</h3>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <select id="orderSortBy" class="form-input" style="width: 220px;" onchange="sortAndDisplayOrders()">
                                <option value="id-desc">Sort: Newest First</option>
                                <option value="id-asc">Sort: Oldest First</option>
                                <option value="total-desc">Sort: Amount (High-Low)</option>
                                <option value="total-asc">Sort: Amount (Low-High)</option>
                                <option value="status-asc">Sort: Status (A-Z)</option>
                                <option value="status-desc">Sort: Status (Z-A)</option>
                            </select>
                            <button class="btn-primary" id="addOrderBtn" onclick="showCreateOrderModal()">
                                + Create Order
                            </button>
                        </div>
                    </div>
                    <div id="ordersTable"></div>
                </div>

                <!-- Shipments Tab -->
                <div id="tab-shipments" class="tab-content">
                    <div class="table-header">
                        <h3 class="table-title">Shipments</h3>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <select id="shipmentStatusFilter" class="form-input" style="width: 180px;" onchange="filterAndDisplayShipments()">
                                <option value="all">Filter: All Statuses</option>
                                <option value="IN_TRANSIT">Filter: In Transit</option>
                                <option value="DELIVERED">Filter: Delivered</option>
                                <option value="CANCELLED">Filter: Cancelled</option>
                            </select>
                            <select id="shipmentSortBy" class="form-input" style="width: 220px;" onchange="filterAndDisplayShipments()">
                                <option value="id-desc">Sort: Newest First</option>
                                <option value="id-asc">Sort: Oldest First</option>
                                <option value="order-desc">Sort: Order (High-Low)</option>
                                <option value="order-asc">Sort: Order (Low-High)</option>
                            </select>
                        </div>
                    </div>
                    <div id="shipmentsTable"></div>
                </div>

                <!-- Activity Tab -->
                <div id="tab-activity" class="tab-content">
                    <h3 class="table-title">Recent Activity</h3>
                    <div class="activity-feed" id="activityFeed"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Customer Modal -->
    <div id="createCustomerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Customer</h3>
                <button class="close-btn" onclick="closeModal('createCustomerModal')">&times;</button>
            </div>
            <form id="createCustomerForm">
                <div class="form-group">
                    <label class="form-label">Name<span class="required-asterisk">*</span></label>
                    <input type="text" name="name" class="form-input" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email<span class="required-asterisk">*</span></label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="createEmailUsername" class="form-input" placeholder="john.doe" style="flex: 2;" required>
                        <span style="display: flex; align-items: center; color: #718096; font-weight: 600;">@</span>
                        <select id="createEmailDomain" class="form-input" style="flex: 1;">
                            <option value="gmail.com">gmail.com</option>
                            <option value="mail.com">mail.com</option>
                            <option value="outlook.com">outlook.com</option>
                            <option value="yahoo.com">yahoo.com</option>
                            <option value="hotmail.com">hotmail.com</option>
                            <option value="icloud.com">icloud.com</option>
                            <option value="protonmail.com">protonmail.com</option>
                        </select>
                    </div>
                    <input type="hidden" name="email" id="createEmailFull">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <select id="createCountryCode" class="form-input" style="flex: 0 0 120px;">
                            <option value="+1"> +1</option>
                            <option value="+91"> +91</option>
                            <option value="+44"> +44</option>
                            <option value="+61"> +61</option>
                            <option value="+81"> +81</option>
                            <option value="+86"> +86</option>
                            <option value="+49"> +49</option>
                            <option value="+33"> +33</option>
                            <option value="+52"> +52</option>
                            <option value="+1"> +1</option>
                        </select>
                        <input type="tel" id="createPhoneNumber" class="form-input" placeholder="9876543210" style="flex: 1;" pattern="[0-9]{7,15}" title="Phone number should contain 7-15 digits">
                    </div>
                    <input type="hidden" name="phone" id="createPhoneFull">
                </div>
                <h4 style="margin: 1.5rem 0 1rem; color: #f1f5f9; border-top: 2px solid rgba(100, 116, 139, 0.3); padding-top: 1.5rem; font-weight: 700;">Shipping Address</h4>
                <div class="form-group">
                    <label class="form-label">Street Address<span class="required-asterisk">*</span></label>
                    <input type="text" name="address_street" class="form-input" placeholder="123 Main Street" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Country<span class="required-asterisk">*</span></label>
                    <select id="createCountry" name="address_country" class="form-input" onchange="updateCityOptions('create')" required>
                        <option value="">Select country...</option>
                        <option value="USA">United States</option>
                        <option value="Canada">Canada</option>
                        <option value="UK">United Kingdom</option>
                        <option value="India">India</option>
                        <option value="Australia">Australia</option>
                        <option value="Germany">Germany</option>
                        <option value="France">France</option>
                        <option value="Japan">Japan</option>
                        <option value="China">China</option>
                        <option value="Mexico">Mexico</option>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">City<span class="required-asterisk">*</span></label>
                        <select id="createCity" name="address_city" class="form-input" onchange="updateStateField('create')" required>
                            <option value="">Select city...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">State<span class="required-asterisk">*</span></label>
                        <input type="text" id="createState" name="address_state" class="form-input" placeholder="CA" required pattern="[A-Za-z ]+" title="State should contain only letters">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ZIP Code<span class="required-asterisk">*</span></label>
                        <input type="text" name="address_zip" class="form-input" placeholder="12345" required pattern="[0-9A-Za-z\s-]+" title="ZIP code should contain only letters, numbers, spaces, or hyphens">
                    </div>
                </div>
                <button type="submit" class="btn-primary">Create Customer</button>
            </form>
            <div id="customerFormMessage"></div>
        </div>
    </div>

    <!-- Create Product Modal -->
    <div id="createProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Product</h3>
                <button class="close-btn" onclick="closeModal('createProductModal')">&times;</button>
            </div>
            <form id="createProductForm">
                <div class="form-group">
                    <label class="form-label">Name<span class="required-asterisk">*</span></label>
                    <input type="text" name="name" class="form-input" placeholder="Wireless Headphones" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea name="description" class="form-input" placeholder="Product description" rows="3" style="resize: vertical;"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Category<span class="required-asterisk">*</span></label>
                    <select id="createProductCategory" name="category" class="form-input" onchange="toggleCustomCategory('create')" required>
                        <option value="">Select category...</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Clothing">Clothing</option>
                        <option value="Home & Garden">Home & Garden</option>
                        <option value="Sports & Outdoors">Sports & Outdoors</option>
                        <option value="Books">Books</option>
                        <option value="Toys & Games">Toys & Games</option>
                        <option value="Food & Beverages">Food & Beverages</option>
                        <option value="Health & Beauty">Health & Beauty</option>
                        <option value="Automotive">Automotive</option>
                        <option value="Custom">Custom...</option>
                    </select>
                </div>
                <div id="createCustomCategoryGroup" class="form-group" style="display: none;">
                    <label class="form-label">Custom Category Name<span class="required-asterisk">*</span></label>
                    <input type="text" id="createCustomCategoryInput" class="form-input" placeholder="Enter custom category">
                </div>
                <div class="form-group">
                    <label class="form-label">Price<span class="required-asterisk">*</span></label>
                    <input type="number" step="0.01" name="price" class="form-input" placeholder="99.99" required min="0.01" title="Price must be a positive number">
                </div>
                <div class="form-group">
                    <label class="form-label">Stock Quantity<span class="required-asterisk">*</span></label>
                    <input type="number" name="stock_quantity" class="form-input" placeholder="50" required min="0" title="Stock quantity must be a non-negative integer">
                </div>
                <h4 style="margin: 1.5rem 0 1rem; color: #f1f5f9; border-top: 2px solid rgba(100, 116, 139, 0.3); padding-top: 1.5rem; font-weight: 700;">Seller Information</h4>
                <div class="form-group">
                    <label class="form-label">Seller Name<span class="required-asterisk">*</span></label>
                    <input type="text" name="seller_name" class="form-input" placeholder="Acme Corp" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Seller Location<span class="required-asterisk">*</span></label>
                    <input type="text" name="seller_location" class="form-input" placeholder="New York, USA" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Seller Badge<span class="required-asterisk">*</span></label>
                    <select name="seller_badge" class="form-input" required>
                        <option value="">Select badge...</option>
                        <option value="Featured">Featured</option>
                        <option value="Verified">Verified</option>
                        <option value="Top Seller">Top Seller</option>
                        <option value="Premium">Premium</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Response Time<span class="required-asterisk">*</span></label>
                    <select name="seller_response_time" class="form-input" required>
                        <option value="">Select response time...</option>
                        <option value="Within 1 hour">Within 1 hour</option>
                        <option value="Within 4 hours">Within 4 hours</option>
                        <option value="Within 24 hours">Within 24 hours</option>
                        <option value="Within 2-3 days">Within 2-3 days</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Create Product</button>
            </form>
            <div id="productFormMessage"></div>
        </div>
    </div>

    <!-- Edit Customer Modal -->
    <div id="editCustomerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Customer</h3>
                <button class="close-btn" onclick="closeModal('editCustomerModal')">&times;</button>
            </div>
            <form id="editCustomerForm">
                <input type="hidden" id="editCustomerId">
                <div class="form-group">
                    <label class="form-label">Name<span class="required-asterisk">*</span></label>
                    <input type="text" id="editCustomerName" class="form-input" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email<span class="required-asterisk">*</span></label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="editEmailUsername" class="form-input" placeholder="john.doe" style="flex: 2;" required>
                        <span style="display: flex; align-items: center; color: #718096; font-weight: 600;">@</span>
                        <select id="editEmailDomain" class="form-input" style="flex: 1;">
                            <option value="gmail.com">gmail.com</option>
                            <option value="mail.com">mail.com</option>
                            <option value="outlook.com">outlook.com</option>
                            <option value="yahoo.com">yahoo.com</option>
                            <option value="hotmail.com">hotmail.com</option>
                            <option value="icloud.com">icloud.com</option>
                            <option value="protonmail.com">protonmail.com</option>
                        </select>
                    </div>
                    <input type="hidden" id="editCustomerEmail">
                </div>
                <div class="form-group">
                    <label class="form-label">Phone</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <select id="editCountryCode" class="form-input" style="flex: 0 0 120px;">
                            <option value="+1"> +1</option>
                            <option value="+91"> +91</option>
                            <option value="+44"> +44</option>
                            <option value="+61"> +61</option>
                            <option value="+81"> +81</option>
                            <option value="+86"> +86</option>
                            <option value="+49"> +49</option>
                            <option value="+33"> +33</option>
                            <option value="+52"> +52</option>
                            <option value="+1"> +1</option>
                        </select>
                        <input type="tel" id="editPhoneNumber" class="form-input" placeholder="9876543210" style="flex: 1;" pattern="[0-9]{7,15}" title="Phone number should contain 7-15 digits">
                    </div>
                    <input type="hidden" id="editCustomerPhone">
                </div>
                <h4 style="margin: 1.5rem 0 1rem; color: #f1f5f9; border-top: 2px solid rgba(100, 116, 139, 0.3); padding-top: 1.5rem; font-weight: 700;">Shipping Address</h4>
                <div class="form-group">
                    <label class="form-label">Street Address<span class="required-asterisk">*</span></label>
                    <input type="text" id="editCustomerStreet" class="form-input" placeholder="123 Main Street" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Country<span class="required-asterisk">*</span></label>
                    <select id="editCustomerCountry" class="form-input" onchange="updateCityOptions('edit')" required>
                        <option value="">Select country...</option>
                        <option value="USA">United States</option>
                        <option value="Canada">Canada</option>
                        <option value="UK">United Kingdom</option>
                        <option value="India">India</option>
                        <option value="Australia">Australia</option>
                        <option value="Germany">Germany</option>
                        <option value="France">France</option>
                        <option value="Japan">Japan</option>
                        <option value="China">China</option>
                        <option value="Mexico">Mexico</option>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">City<span class="required-asterisk">*</span></label>
                        <select id="editCustomerCity" class="form-input" onchange="updateStateField('edit')" required>
                            <option value="">Select city...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">State<span class="required-asterisk">*</span></label>
                        <input type="text" id="editCustomerState" class="form-input" placeholder="CA" required pattern="[A-Za-z ]+" title="State should contain only letters">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ZIP Code<span class="required-asterisk">*</span></label>
                        <input type="text" id="editCustomerZip" class="form-input" placeholder="12345" required pattern="[0-9A-Za-z\s-]+" title="ZIP code should contain only letters, numbers, spaces, or hyphens">
                    </div>
                </div>
                <button type="submit" class="btn-primary">Update Customer</button>
            </form>
            <div id="editCustomerMessage"></div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="editProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Edit Product</h3>
                <button class="close-btn" onclick="closeModal('editProductModal')">&times;</button>
            </div>
            <form id="editProductForm">
                <input type="hidden" id="editProductId">
                <div class="form-group">
                    <label class="form-label">Name<span class="required-asterisk">*</span></label>
                    <input type="text" id="editProductName" class="form-input" placeholder="Wireless Headphones" required>
                </div>
                <div class="form-group">
                    <label class="form-label">SKU</label>
                    <input type="text" id="editProductSKU" class="form-input" readonly style="background-color: rgba(15, 23, 42, 0.6); cursor: not-allowed; color: #cbd5e0; border-color: rgba(100, 116, 139, 0.4);">
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="editProductDescription" class="form-input" placeholder="Product description" rows="3" style="resize: vertical;"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Category<span class="required-asterisk">*</span></label>
                    <select id="editProductCategory" class="form-input" onchange="toggleCustomCategory('edit')" required>
                        <option value="">Select category...</option>
                        <option value="Electronics">Electronics</option>
                        <option value="Clothing">Clothing</option>
                        <option value="Home & Garden">Home & Garden</option>
                        <option value="Sports & Outdoors">Sports & Outdoors</option>
                        <option value="Books">Books</option>
                        <option value="Toys & Games">Toys & Games</option>
                        <option value="Food & Beverages">Food & Beverages</option>
                        <option value="Health & Beauty">Health & Beauty</option>
                        <option value="Automotive">Automotive</option>
                        <option value="Custom">Custom...</option>
                    </select>
                </div>
                <div id="editCustomCategoryGroup" class="form-group" style="display: none;">
                    <label class="form-label">Custom Category Name<span class="required-asterisk">*</span></label>
                    <input type="text" id="editCustomCategoryInput" class="form-input" placeholder="Enter custom category">
                </div>
                <div class="form-group">
                    <label class="form-label">Price<span class="required-asterisk">*</span></label>
                    <input type="number" step="0.01" id="editProductPrice" class="form-input" placeholder="99.99" required min="0.01" title="Price must be a positive number">
                </div>
                <div class="form-group">
                    <label class="form-label">Stock Quantity<span class="required-asterisk">*</span></label>
                    <input type="number" id="editProductStock" class="form-input" required min="0" title="Stock quantity must be a non-negative integer">
                    <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #718096;">
                        Stock Status: 
                        <span style="color: #48bb78;">In Stock</span> (>10 units), 
                        <span style="color: #ed8936;">Low Stock</span> (1-10 units), 
                        <span style="color: #f56565;">Out of Stock</span> (0 units)
                    </div>
                </div>
                <h4 style="margin: 1.5rem 0 1rem; color: #f1f5f9; border-top: 2px solid rgba(100, 116, 139, 0.3); padding-top: 1.5rem; font-weight: 700;">Seller Information</h4>
                <div class="form-group">
                    <label class="form-label">Seller Name<span class="required-asterisk">*</span></label>
                    <input type="text" id="editProductSellerName" class="form-input" placeholder="Acme Corp" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Seller Location<span class="required-asterisk">*</span></label>
                    <input type="text" id="editProductSellerLocation" class="form-input" placeholder="New York, USA" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Seller Badge<span class="required-asterisk">*</span></label>
                    <select id="editProductSellerBadge" class="form-input" required>
                        <option value="">Select badge...</option>
                        <option value="Featured">Featured</option>
                        <option value="Verified">Verified</option>
                        <option value="Top Seller">Top Seller</option>
                        <option value="Premium">Premium</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Response Time<span class="required-asterisk">*</span></label>
                    <select id="editProductResponseTime" class="form-input" required>
                        <option value="">Select response time...</option>
                        <option value="Within 1 hour">Within 1 hour</option>
                        <option value="Within 4 hours">Within 4 hours</option>
                        <option value="Within 24 hours">Within 24 hours</option>
                        <option value="Within 2-3 days">Within 2-3 days</option>
                    </select>
                </div>
                <button type="submit" class="btn-primary">Update Product</button>
            </form>
            <div id="editProductMessage"></div>
        </div>
    </div>

    <!-- Create Order Modal (Integrated Cart-Style) -->
    <div id="createOrderModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">Create New Order</h3>
                <button class="close-btn" onclick="closeModal('createOrderModal')">&times;</button>
            </div>
            <div id="orderCreationContent">
                <!-- Step 1: Select Customer -->
                <div class="form-group">
                    <label class="form-label">Select Customer *</label>
                    <select id="orderCustomerSelect" class="form-input" required>
                        <option value="">-- Choose a customer --</option>
                    </select>
                </div>

                <!-- Step 2: Add Products to Cart -->
                <div class="form-group" style="margin-top: 1.5rem;">
                    <label class="form-label">Add Products to Order</label>
                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                        <select id="orderProductSelect" class="form-input" style="flex: 1; min-width: 0;">
                            <option value="">-- Choose a product --</option>
                        </select>
                        <input type="number" id="orderProductQty" class="form-input" placeholder="1" min="1" value="1" style="width: 60px; flex-shrink: 0;" title="Quantity must be at least 1">
                        <button type="button" onclick="addProductToCart()" class="btn-primary" style="flex-shrink: 0; padding: 0.75rem 1rem;">
                            + Add
                        </button>
                    </div>
                </div>

                <!-- Cart Display -->
                <div id="orderCart" style="margin-top: 1.5rem;">
                    <h4 style="margin-bottom: 1rem; color: #f1f5f9; font-weight: 700;">Order Items</h4>
                    <div id="cartItems" style="min-height: 100px;">
                        <div style="text-align: center; padding: 2rem; color: #718096;">
                            No items in cart. Add products above.
                        </div>
                    </div>
                </div>

                <!-- Order Summary -->
                <div style="margin-top: 1.5rem; padding: 1.5rem; background: rgba(30, 41, 59, 0.6); border-radius: 8px; border: 1px solid rgba(100, 116, 139, 0.3);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: #cbd5e0; font-weight: 600;">Subtotal:</span>
                        <span id="orderSubtotal" style="font-weight: 700; color: #f1f5f9;">$0.00</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding-top: 0.75rem; border-top: 2px solid rgba(100, 116, 139, 0.4); margin-top: 0.75rem;">
                        <span style="font-size: 1.25rem; font-weight: 700; color: #f1f5f9;">Total:</span>
                        <span id="orderTotal" style="font-size: 1.25rem; font-weight: 700; color: #60a5fa;">$0.00</span>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="button" onclick="submitOrder()" class="btn-primary" style="width: 100%; margin-top: 1.5rem; padding: 1rem;" id="submitOrderBtn" disabled>
                    Create Order
                </button>
            </div>
            <div id="orderFormMessage"></div>
        </div>
    </div>

    <script>
        let authCredentials = null;
        let currentUser = null;
        let ws = null;
        let currentTab = 'overview';
        let serviceUptime = {}; // Track service start times
        const serviceStartTime = new Date();

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            authCredentials = btoa(`${username}:${password}`);
            try { sessionStorage.setItem('authCredentials', authCredentials); } catch (e) { /* ignore */ }

            try {
                const response = await fetch('/api/user_info', {
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });

                if (response.ok) {
                    currentUser = await response.json();
                    showDashboard();
                } else {
                    showLoginError('Invalid credentials');
                }
            } catch (error) {
                showLoginError('Login failed');
            }
        });

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function getGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return 'Good morning';
            if (hour < 18) return 'Good afternoon';
            return 'Good evening';
        }

        function showDashboard() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('dashboardContainer').style.display = 'block';
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRole').textContent = currentUser.role.toUpperCase();
            
            // Set personalized greeting
            const greeting = `${getGreeting()}, ${currentUser.name.split(' ')[0]}!`;
            document.getElementById('greeting').textContent = greeting;
            const subtitle = currentUser.role === 'admin' 
                ? "You have full access to all platform features"
                : "You're viewing the platform in read-only mode";
            document.getElementById('greetingSubtitle').textContent = subtitle;

            // Disable admin actions for guests
            if (currentUser.role === 'guest') {
                document.getElementById('addCustomerBtn').disabled = true;
                document.getElementById('addProductBtn').disabled = true;
                document.getElementById('addOrderBtn').disabled = true;
                // Show admin notifications widget with guest notice
                document.getElementById('adminNotifications').style.display = 'block';
                document.getElementById('guestActionNotice').style.display = 'inline';
            } else {
                // Show admin notifications widget for admins
                document.getElementById('adminNotifications').style.display = 'block';
            }

            // Start WebSocket for real-time updates
            connectWebSocket();
            
            // Load initial data
            loadAllData();
            
            // Load admin notifications for admin users
            if (currentUser.role === 'admin') {
                loadAdminNotifications();
                setInterval(() => loadAdminNotifications(), 10000); // Refresh every 10 seconds
            }
            
            // Refresh data every 5 seconds
            setInterval(() => loadAllData(), 5000);
        }

        function logout() {
            authCredentials = null;
            currentUser = null;
            try { sessionStorage.removeItem('authCredentials'); } catch (e) { /* ignore */ }
            if (ws) ws.close();
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('dashboardContainer').style.display = 'none';
            document.getElementById('loginForm').reset();
        }

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            ws = new WebSocket(`${protocol}//${window.location.host}/ws`);
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                updateMetrics(data);
            };
            
            ws.onerror = () => setTimeout(connectWebSocket, 5000);
            ws.onclose = () => setTimeout(connectWebSocket, 5000);
        }

        function updateMetrics(data) {
            document.getElementById('totalOrders').textContent = data.totals.orders_placed_total || 0;
            
            let healthy = 0;
            let total = Object.keys(data.services).length;
            for (const [name, info] of Object.entries(data.services)) {
                if (info.status === 'healthy') healthy++;
            }
            document.getElementById('activeServices').textContent = `${healthy}/${total}`;

            if (currentTab === 'overview') {
                updateServicesStatus(data.services);
            }
        }

        function formatUptime(startTime) {
            const now = new Date();
            const diff = Math.floor((now - startTime) / 1000);
            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            const seconds = diff % 60;
            
            if (hours > 0) return `${hours}h ${minutes}m`;
            if (minutes > 0) return `${minutes}m ${seconds}s`;
            return `${seconds}s`;
        }

        // City data for each country with state/province information
        const cityData = {
            USA: [
                {city: 'New York', state: 'NY'},
                {city: 'Los Angeles', state: 'CA'},
                {city: 'Chicago', state: 'IL'},
                {city: 'Houston', state: 'TX'},
                {city: 'Phoenix', state: 'AZ'},
                {city: 'Philadelphia', state: 'PA'},
                {city: 'San Antonio', state: 'TX'},
                {city: 'San Diego', state: 'CA'},
                {city: 'Dallas', state: 'TX'},
                {city: 'San Jose', state: 'CA'}
            ],
            Canada: [
                {city: 'Toronto', state: 'ON'},
                {city: 'Montreal', state: 'QC'},
                {city: 'Vancouver', state: 'BC'},
                {city: 'Calgary', state: 'AB'},
                {city: 'Edmonton', state: 'AB'},
                {city: 'Ottawa', state: 'ON'},
                {city: 'Winnipeg', state: 'MB'},
                {city: 'Quebec City', state: 'QC'},
                {city: 'Hamilton', state: 'ON'},
                {city: 'Kitchener', state: 'ON'}
            ],
            UK: [
                {city: 'London', state: 'England'},
                {city: 'Birmingham', state: 'England'},
                {city: 'Manchester', state: 'England'},
                {city: 'Glasgow', state: 'Scotland'},
                {city: 'Liverpool', state: 'England'},
                {city: 'Leeds', state: 'England'},
                {city: 'Sheffield', state: 'England'},
                {city: 'Edinburgh', state: 'Scotland'},
                {city: 'Bristol', state: 'England'},
                {city: 'Cardiff', state: 'Wales'}
            ],
            India: [
                {city: 'Mumbai', state: 'Maharashtra'},
                {city: 'Delhi', state: 'Delhi'},
                {city: 'Bangalore', state: 'Karnataka'},
                {city: 'Hyderabad', state: 'Telangana'},
                {city: 'Chennai', state: 'Tamil Nadu'},
                {city: 'Kolkata', state: 'West Bengal'},
                {city: 'Pune', state: 'Maharashtra'},
                {city: 'Ahmedabad', state: 'Gujarat'},
                {city: 'Jaipur', state: 'Rajasthan'},
                {city: 'Surat', state: 'Gujarat'}
            ],
            Australia: [
                {city: 'Sydney', state: 'NSW'},
                {city: 'Melbourne', state: 'VIC'},
                {city: 'Brisbane', state: 'QLD'},
                {city: 'Perth', state: 'WA'},
                {city: 'Adelaide', state: 'SA'},
                {city: 'Gold Coast', state: 'QLD'},
                {city: 'Canberra', state: 'ACT'},
                {city: 'Newcastle', state: 'NSW'},
                {city: 'Wollongong', state: 'NSW'},
                {city: 'Hobart', state: 'TAS'}
            ],
            Germany: [
                {city: 'Berlin', state: 'Berlin'},
                {city: 'Hamburg', state: 'Hamburg'},
                {city: 'Munich', state: 'Bavaria'},
                {city: 'Cologne', state: 'North Rhine-Westphalia'},
                {city: 'Frankfurt', state: 'Hesse'},
                {city: 'Stuttgart', state: 'Baden-Wrttemberg'},
                {city: 'Dsseldorf', state: 'North Rhine-Westphalia'},
                {city: 'Dortmund', state: 'North Rhine-Westphalia'},
                {city: 'Essen', state: 'North Rhine-Westphalia'},
                {city: 'Leipzig', state: 'Saxony'}
            ],
            France: [
                {city: 'Paris', state: 'le-de-France'},
                {city: 'Marseille', state: 'Provence-Alpes-Cte d\'Azur'},
                {city: 'Lyon', state: 'Auvergne-Rhne-Alpes'},
                {city: 'Toulouse', state: 'Occitanie'},
                {city: 'Nice', state: 'Provence-Alpes-Cte d\'Azur'},
                {city: 'Nantes', state: 'Pays de la Loire'},
                {city: 'Strasbourg', state: 'Grand Est'},
                {city: 'Montpellier', state: 'Occitanie'},
                {city: 'Bordeaux', state: 'Nouvelle-Aquitaine'},
                {city: 'Lille', state: 'Hauts-de-France'}
            ],
            Japan: [
                {city: 'Tokyo', state: 'Tokyo'},
                {city: 'Osaka', state: 'Osaka'},
                {city: 'Yokohama', state: 'Kanagawa'},
                {city: 'Nagoya', state: 'Aichi'},
                {city: 'Sapporo', state: 'Hokkaido'},
                {city: 'Fukuoka', state: 'Fukuoka'},
                {city: 'Kobe', state: 'Hyogo'},
                {city: 'Kyoto', state: 'Kyoto'},
                {city: 'Kawasaki', state: 'Kanagawa'},
                {city: 'Saitama', state: 'Saitama'}
            ],
            China: [
                {city: 'Beijing', state: 'Beijing'},
                {city: 'Shanghai', state: 'Shanghai'},
                {city: 'Guangzhou', state: 'Guangdong'},
                {city: 'Shenzhen', state: 'Guangdong'},
                {city: 'Chengdu', state: 'Sichuan'},
                {city: 'Hangzhou', state: 'Zhejiang'},
                {city: 'Wuhan', state: 'Hubei'},
                {city: 'Xi\'an', state: 'Shaanxi'},
                {city: 'Chongqing', state: 'Chongqing'},
                {city: 'Tianjin', state: 'Tianjin'}
            ],
            Mexico: [
                {city: 'Mexico City', state: 'CDMX'},
                {city: 'Guadalajara', state: 'Jalisco'},
                {city: 'Monterrey', state: 'Nuevo Len'},
                {city: 'Puebla', state: 'Puebla'},
                {city: 'Tijuana', state: 'Baja California'},
                {city: 'Len', state: 'Guanajuato'},
                {city: 'Jurez', state: 'Chihuahua'},
                {city: 'Zapopan', state: 'Jalisco'},
                {city: 'Mrida', state: 'Yucatn'},
                {city: 'Cancn', state: 'Quintana Roo'}
            ]
        };

        function updateCityOptions(formType) {
            const countrySelect = document.getElementById(formType === 'create' ? 'createCountry' : 'editCustomerCountry');
            const citySelect = document.getElementById(formType === 'create' ? 'createCity' : 'editCustomerCity');
            const stateField = document.getElementById(formType === 'create' ? 'createState' : 'editCustomerState');
            const country = countrySelect.value;
            
            // Clear current city options and state
            citySelect.innerHTML = '<option value="">Select city...</option>';
            stateField.value = '';
            
            // Populate cities based on selected country
            if (cityData[country]) {
                cityData[country].forEach(cityInfo => {
                    const option = document.createElement('option');
                    option.value = cityInfo.city;
                    option.textContent = cityInfo.city;
                    option.dataset.state = cityInfo.state;  // Store state in data attribute
                    citySelect.appendChild(option);
                });
            }
        }

        function updateStateField(formType) {
            const citySelect = document.getElementById(formType === 'create' ? 'createCity' : 'editCustomerCity');
            const stateField = document.getElementById(formType === 'create' ? 'createState' : 'editCustomerState');
            
            // Get the selected option and its state data
            const selectedOption = citySelect.options[citySelect.selectedIndex];
            if (selectedOption && selectedOption.dataset.state) {
                stateField.value = selectedOption.dataset.state;
            } else {
                stateField.value = '';
            }
        }

        function toggleCustomCategory(formType) {
            const categorySelect = document.getElementById(formType === 'create' ? 'createProductCategory' : 'editProductCategory');
            const customGroup = document.getElementById(formType === 'create' ? 'createCustomCategoryGroup' : 'editCustomCategoryGroup');
            const customInput = document.getElementById(formType === 'create' ? 'createCustomCategoryInput' : 'editCustomCategoryInput');
            
            if (categorySelect.value === 'Custom') {
                customGroup.style.display = 'block';
                customInput.required = true;
            } else {
                customGroup.style.display = 'none';
                customInput.required = false;
                customInput.value = '';
            }
        }

        function updateServicesStatus(services) {
            const container = document.getElementById('servicesStatus');
            let html = '';
            
            for (const [name, info] of Object.entries(services)) {
                // Initialize uptime tracking
                if (!serviceUptime[name] && info.status === 'healthy') {
                    serviceUptime[name] = new Date();
                } else if (info.status !== 'healthy') {
                    delete serviceUptime[name];
                }
                
                const statusColor = info.status === 'healthy' ? '#48bb78' : '#f56565';
                const uptime = serviceUptime[name] ? formatUptime(serviceUptime[name]) : 'Offline';
                
                html += `
                    <div class="service-card">
                        <div class="service-card-header">
                            <div class="service-name">${name}</div>
                            <div class="service-status-indicator" style="background-color: ${statusColor};"></div>
                        </div>
                        <div class="service-metrics">
                            <div class="service-metric">
                                <span class="service-metric-label">Status</span>
                                <span class="service-metric-value" style="color: ${statusColor};">${info.status.toUpperCase()}</span>
                            </div>
                            <div class="service-metric">
                                <span class="service-metric-label">Version</span>
                                <span class="service-metric-value">${info.version ? info.version : 'N/A'}</span>
                            </div>
                            <div class="service-metric">
                                <span class="service-metric-label">Release</span>
                                <span class="service-metric-value">${info.releaseId ? info.releaseId : 'N/A'}</span>
                            </div>
                            <div class="service-metric">
                                <span class="service-metric-label">Response Time</span>
                                <span class="service-metric-value">${info.response_time_ms !== undefined ? info.response_time_ms + 'ms' : 'N/A'}</span>
                            </div>
                            <div class="service-metric">
                                <span class="service-metric-label">Uptime</span>
                                <span class="service-metric-value">${uptime}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        async function loadAllData() {
            await Promise.all([
                loadCustomers(),
                loadProducts(),
                loadOrders()
            ]);
        }
        
        async function loadAdminNotifications() {
            if (!currentUser || currentUser.role !== 'admin') return;
            
            try {
                const response = await fetch('/api/admin_notifications', {
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // Update main dashboard widget
                    document.getElementById('pendingPaymentsCount').textContent = data.pending_payment_approvals;
                    document.getElementById('readyToShipCount').textContent = data.ready_to_ship;
                    document.getElementById('inTransitCount').textContent = data.in_transit;
                    document.getElementById('totalActionItems').textContent = data.total_action_items;
                    
                    // Show/hide the notification widget based on action items count
                    const notificationWidget = document.getElementById('adminNotifications');
                    if (data.total_action_items > 0) {
                        notificationWidget.style.display = 'block';
                        notificationWidget.classList.remove('fade-out');
                    } else {
                        // Fade out smoothly when all items are complete
                        notificationWidget.classList.add('fade-out');
                        setTimeout(() => {
                            if (notificationWidget.classList.contains('fade-out')) {
                                notificationWidget.style.display = 'none';
                            }
                        }, 500); // Match transition duration
                    }
                }
            } catch (error) {
                console.error('Failed to load admin notifications:', error);
            }
        }

        async function loadCustomers() {
            try {
                const response = await fetch('/api/customers', {
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                const customers = await response.json();
                document.getElementById('totalCustomers').textContent = customers.length;
                
                // Store globally
                window.customersData = customers;
                
                if (currentTab === 'customers') {
                    sortAndDisplayCustomers(true); // Preserve current page during auto-refresh
                }
            } catch (error) {
                console.error('Failed to load customers:', error);
            }
        }

        // Pagination state
        let customersPage = 1;
        const customersPerPage = 20;
        let sortedCustomersData = []; // Store sorted customers for pagination
        
        function sortAndDisplayCustomers(preservePage = false) {
            if (!window.customersData) return;
            const sortBy = document.getElementById('customerSortBy').value;
            const sorted = [...window.customersData];
            
            const [field, direction] = sortBy.split('-');
            sorted.sort((a, b) => {
                let aVal = field === 'id' ? a.id : a.name.toLowerCase();
                let bVal = field === 'id' ? b.id : b.name.toLowerCase();
                
                if (direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            sortedCustomersData = sorted; // Store sorted data
            if (!preservePage) {
                customersPage = 1; // Only reset to page 1 if not preserving
            }
            displayCustomers(sorted);
        }
        
        function displayCustomers(customers) {
            const container = document.getElementById('customersTable');
            if (customers.length === 0) {
                container.innerHTML = '<div class="empty-state">No customers yet. Click "+ Add Customer" to create one.</div>';
                return;
            }
            
            // Pagination logic
            const totalPages = Math.ceil(customers.length / customersPerPage);
            // Safety check: if current page exceeds total pages, reset to last page
            if (customersPage > totalPages) {
                customersPage = totalPages;
            }
            const startIndex = (customersPage - 1) * customersPerPage;
            const endIndex = startIndex + customersPerPage;
            const paginatedCustomers = customers.slice(startIndex, endIndex);

            let html = '<div class="data-grid">';
            paginatedCustomers.forEach(customer => {
                const showActions = currentUser && currentUser.role === 'admin';
                html += `
                    <div class="data-card">
                        <div class="data-card-header">
                            <div class="data-card-title">${customer.name}</div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div class="data-card-id">#${customer.id}</div>
                                ${showActions ? `
                                <button onclick="editCustomer(${customer.id})" class="btn-secondary" style="padding: 0.35rem 0.75rem; font-size: 0.75rem; transition: all 0.2s;"
                                        onmouseover="this.style.background='#4a5568';" onmouseout="this.style.background='#718096';">
                                    Edit
                                </button>
                                <button onclick="deleteCustomer(${customer.id})" class="btn-danger" style="padding: 0.35rem 0.75rem; font-size: 0.75rem; transition: all 0.2s;"
                                        onmouseover="this.style.background='#c53030';" onmouseout="this.style.background='#ef4444';">
                                    Delete
                                </button>` : ''}
                            </div>
                        </div>
                        <div class="data-card-body">
                            <div class="data-field">
                                <div class="data-label">Email</div>
                                <div class="data-value" style="word-break: break-word;">${customer.email || 'Not provided'}</div>
                            </div>
                            <div class="data-field">
                                <div class="data-label">Phone</div>
                                <div class="data-value">${customer.phone || 'Not provided'}</div>
                            </div>
                            <div class="data-field" style="grid-column: 1 / -1;">
                                <div class="data-label">Shipping Address</div>
                                <div class="data-value" style="font-size: 0.875rem; line-height: 1.6;">
                                    ${customer.address_street ? 
                                        `<div>${customer.address_street}</div>
                                         <div>${customer.address_city || ''}${customer.address_city && customer.address_state ? ', ' : ''}${customer.address_state || ''} ${customer.address_zip || ''}</div>
                                         <div>${customer.address_country || ''}</div>` 
                                        : '<span style="color: #cbd5e0;">No address on file</span>'}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            // Add pagination
            if (totalPages > 1) {
                html += '<div class="pagination">';
                html += `<button class="pagination-button" onclick="changeCustomersPage(${customersPage - 1})" ${customersPage === 1 ? 'disabled' : ''}>Previous</button>`;
                
                // Smart page number display
                let startPage = Math.max(1, customersPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);
                
                // Adjust if we're near the end
                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    html += `<button class="pagination-button ${customersPage === i ? 'active' : ''}" onclick="changeCustomersPage(${i})">${i}</button>`;
                }
                
                if (endPage < totalPages) {
                    html += `<span class="pagination-info">...</span>`;
                    html += `<button class="pagination-button" onclick="changeCustomersPage(${totalPages})">${totalPages}</button>`;
                }
                
                html += `<button class="pagination-button" onclick="changeCustomersPage(${customersPage + 1})" ${customersPage === totalPages ? 'disabled' : ''}>Next</button>`;
                html += `<span class="pagination-info">Showing ${startIndex + 1}-${Math.min(endIndex, customers.length)} of ${customers.length}</span>`;
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        function changeCustomersPage(page) {
            const dataToUse = sortedCustomersData.length > 0 ? sortedCustomersData : window.customersData;
            if (page < 1 || page > Math.ceil(dataToUse.length / customersPerPage)) return;
            customersPage = page;
            displayCustomers(dataToUse);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function loadProducts() {
            try {
                const response = await fetch('/api/products', {
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                const products = await response.json();
                document.getElementById('totalProducts').textContent = products.length;
                
                // Store products globally for edit
                window.productsData = products;
                
                if (currentTab === 'products') {
                    sortAndDisplayProducts(true); // Preserve current page during auto-refresh
                }
            } catch (error) {
                console.error('Failed to load products:', error);
            }
        }

        // Products pagination state
        let productsPage = 1;
        const productsPerPage = 20;
        let sortedProductsData = []; // Store sorted products for pagination
        
        function sortAndDisplayProducts(preservePage = false) {
            if (!window.productsData) return;
            const sortBy = document.getElementById('productSortBy').value;
            const sorted = [...window.productsData];
            
            const [field, direction] = sortBy.split('-');
            sorted.sort((a, b) => {
                let aVal, bVal;
                switch(field) {
                    case 'id':
                        aVal = a.id; bVal = b.id; break;
                    case 'name':
                        aVal = a.name.toLowerCase(); bVal = b.name.toLowerCase(); break;
                    case 'price':
                        aVal = parseFloat(a.price); bVal = parseFloat(b.price); break;
                    case 'stock':
                        aVal = a.stock_quantity || 0; bVal = b.stock_quantity || 0; break;
                }
                
                if (direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            sortedProductsData = sorted; // Store sorted data
            if (!preservePage) {
                productsPage = 1; // Only reset to page 1 if not preserving
            }
            displayProducts(sorted);
        }
        
        function displayProducts(products) {
            const container = document.getElementById('productsTable');
            if (products.length === 0) {
                container.innerHTML = '<div class="empty-state">No products yet. Click "+ Add Product" to create one.</div>';
                return;
            }
            
            // Pagination logic
            const totalPages = Math.ceil(products.length / productsPerPage);
            // Safety check: if current page exceeds total pages, reset to last page
            if (productsPage > totalPages) {
                productsPage = totalPages;
            }
            const startIndex = (productsPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const paginatedProducts = products.slice(startIndex, endIndex);

            // Check if user is guest for read-only mode
            const isGuest = currentUser && currentUser.role === 'guest';

            let html = '<div class="data-grid">';
            paginatedProducts.forEach(product => {
                const stockStatus = product.stock_quantity > 10 ? 'In Stock' : product.stock_quantity > 0 ? 'Low Stock' : 'Out of Stock';
                const stockColor = product.stock_quantity > 10 ? '#48bb78' : product.stock_quantity > 0 ? '#ed8936' : '#f56565';
                
                html += `
                    <div class="data-card">
                        <div class="data-card-header">
                            <div class="data-card-title">${product.name}</div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div class="data-card-id">${product.sku}</div>
                                ${!isGuest ? `
                                <button onclick="editProduct(${product.id})" class="btn-secondary" style="padding: 0.35rem 0.75rem; font-size: 0.75rem; transition: all 0.2s;"
                                        onmouseover="this.style.background='#4a5568';" onmouseout="this.style.background='#718096';">
                                    Edit
                                </button>
                                <button onclick="deleteProduct(${product.id})" class="btn-danger" style="padding: 0.35rem 0.75rem; font-size: 0.75rem; transition: all 0.2s;"
                                        onmouseover="this.style.background='#c53030';" onmouseout="this.style.background='#ef4444';">
                                    Delete
                                </button>
                                ` : ''}
                            </div>
                        </div>
                        <div class="data-card-body">
                            ${product.description ? `
                            <div class="data-field" style="grid-column: 1 / -1;">
                                <div class="data-label">Description</div>
                                <div class="data-value" style="font-size: 0.875rem; color: #cbd5e0;">${product.description}</div>
                            </div>` : ''}
                            <div class="data-field">
                                <div class="data-label">Category</div>
                                <div class="data-value">${product.category || 'N/A'}</div>
                            </div>
                            <div class="data-field">
                                <div class="data-label">Price</div>
                                <div class="data-value">$${parseFloat(product.price).toFixed(2)}</div>
                            </div>
                            <div class="data-field">
                                <div class="data-label">Stock</div>
                                <div class="data-value" style="color: ${stockColor};">${product.stock_quantity || 0} units</div>
                            </div>
                            <div class="data-field">
                                <div class="data-label">Status</div>
                                <div class="data-value" style="color: ${stockColor};">${stockStatus}</div>
                            </div>
                            ${product.seller_name ? `
                            <div class="data-field" style="grid-column: 1 / -1; border-top: 1px solid rgba(100, 116, 139, 0.3); padding-top: 0.75rem; margin-top: 0.75rem;">
                                <div class="data-label" style="font-weight: 700; color: #cbd5e0;">Seller Info</div>
                                <div style="display: grid; gap: 0.5rem; margin-top: 0.5rem;">
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-size: 0.875rem; color: #94a3b8;">Name:</span>
                                        <span style="font-size: 0.875rem; font-weight: 600; color: #f1f5f9;">${product.seller_name}</span>
                                    </div>
                                    ${product.seller_location ? `
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-size: 0.875rem; color: #94a3b8;">Location:</span>
                                        <span style="font-size: 0.875rem; color: #e2e8f0;">${product.seller_location}</span>
                                    </div>` : ''}
                                    ${product.seller_badge ? `
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-size: 0.875rem; color: #94a3b8;">Badge:</span>
                                        <span style="font-size: 0.875rem; padding: 0.125rem 0.5rem; background: #667eea; color: white; border-radius: 4px;">${product.seller_badge}</span>
                                    </div>` : ''}
                                    ${product.seller_response_time ? `
                                    <div style="display: flex; justify-content: space-between;">
                                        <span style="font-size: 0.875rem; color: #94a3b8;">Response:</span>
                                        <span style="font-size: 0.875rem; color: #e2e8f0;">${product.seller_response_time}</span>
                                    </div>` : ''}
                                </div>
                            </div>` : ''}
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            // Add pagination
            if (totalPages > 1) {
                html += '<div class="pagination">';
                html += `<button class="pagination-button" onclick="changeProductsPage(${productsPage - 1})" ${productsPage === 1 ? 'disabled' : ''}>Previous</button>`;
                
                // Smart page number display
                let startPage = Math.max(1, productsPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);
                
                // Adjust if we're near the end
                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    html += `<button class="pagination-button ${productsPage === i ? 'active' : ''}" onclick="changeProductsPage(${i})">${i}</button>`;
                }
                
                if (endPage < totalPages) {
                    html += `<span class="pagination-info">...</span>`;
                    html += `<button class="pagination-button" onclick="changeProductsPage(${totalPages})">${totalPages}</button>`;
                }
                
                html += `<button class="pagination-button" onclick="changeProductsPage(${productsPage + 1})" ${productsPage === totalPages ? 'disabled' : ''}>Next</button>`;
                html += `<span class="pagination-info">Showing ${startIndex + 1}-${Math.min(endIndex, products.length)} of ${products.length}</span>`;
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        function changeProductsPage(page) {
            const dataToUse = sortedProductsData.length > 0 ? sortedProductsData : window.productsData;
            if (page < 1 || page > Math.ceil(dataToUse.length / productsPerPage)) return;
            productsPage = page;
            displayProducts(dataToUse);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function loadOrders() {
            try {
                const response = await fetch('/api/orders', {
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                const orders = await response.json();
                
                // Store globally
                window.ordersData = orders;
                
                if (currentTab === 'orders') {
                    sortAndDisplayOrders(true); // Preserve current page during auto-refresh
                }
            } catch (error) {
                console.error('Failed to load orders:', error);
            }
        }

        // Orders pagination state
        let ordersPage = 1;
        const ordersPerPage = 10;
        let sortedOrdersData = []; // Store sorted orders for pagination
        
        function sortAndDisplayOrders(preservePage = false) {
            if (!window.ordersData) return;
            const sortBy = document.getElementById('orderSortBy').value;
            const sorted = [...window.ordersData];
            
            const [field, direction] = sortBy.split('-');
            sorted.sort((a, b) => {
                let aVal, bVal;
                switch(field) {
                    case 'id':
                        aVal = a.id; bVal = b.id; break;
                    case 'total':
                        aVal = parseFloat(a.order_total); bVal = parseFloat(b.order_total); break;
                    case 'status':
                        aVal = a.order_status.toLowerCase(); bVal = b.order_status.toLowerCase(); break;
                }
                
                if (direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            sortedOrdersData = sorted; // Store sorted data
            if (!preservePage) {
                ordersPage = 1; // Only reset to page 1 if not preserving
            }
            displayOrders(sorted);
        }
        
        function displayOrders(orders) {
            const container = document.getElementById('ordersTable');
            if (orders.length === 0) {
                container.innerHTML = '<div class="empty-state">No orders yet. Click "+ Create Order" to create one.</div>';
                return;
            }
            
            // Pagination logic
            const totalPages = Math.ceil(orders.length / ordersPerPage);
            // Safety check: if current page exceeds total pages, reset to last page
            if (ordersPage > totalPages) {
                ordersPage = totalPages;
            }
            const startIndex = (ordersPage - 1) * ordersPerPage;
            const endIndex = startIndex + ordersPerPage;
            const paginatedOrders = orders.slice(startIndex, endIndex);

            let html = '<div style="display: flex; flex-direction: column; gap: 1rem;">';
            paginatedOrders.forEach(order => {
                const statusClass = order.order_status.toLowerCase().replace('_', '-');
                const paymentClass = order.payment_status.toLowerCase();
                
                // Show customer name instead of just ID
                const customerDisplay = order.customer_name || `Customer #${order.customer_id}`;
                
                // Build items without images
                let itemsHtml = '';
                if (order.items && order.items.length > 0) {
                    const displayItems = order.items.slice(0, 3); // Show first 3 items
                    displayItems.forEach(item => {
                        itemsHtml += `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: rgba(30, 41, 59, 0.4); border-radius: 6px; border: 1px solid rgba(100, 116, 139, 0.2);">
                                <div style="flex: 1; min-width: 0;">
                                    <div style="font-weight: 600; font-size: 0.9rem; color: #f1f5f9;">${item.product_name || 'Product'}</div>
                                    <div style="font-size: 0.8rem; color: #94a3b8; margin-top: 0.25rem;">SKU: ${item.sku || 'N/A'} | Qty: ${item.quantity}</div>
                                    ${item.seller_name ? `<div style="font-size: 0.75rem; color: #60a5fa; margin-top: 0.25rem;">Seller: ${item.seller_name}</div>` : ''}
                                </div>
                                <div style="font-weight: 700; color: #60a5fa; font-size: 0.95rem; white-space: nowrap; margin-left: 1rem;">$${(item.quantity * item.unit_price).toFixed(2)}</div>
                            </div>
                        `;
                    });
                    if (order.items.length > 3) {
                        itemsHtml += `<div style="text-align: center; padding: 0.5rem; color: #667eea; font-size: 0.875rem;">+${order.items.length - 3} more items</div>`;
                    }
                }
                
                // Payment action buttons for pending payments
                const showPaymentActions = currentUser && currentUser.role === 'admin' && 
                                         order.payment_status === 'PENDING';
                
                // Order action buttons based on status
                let orderActions = '';
                if (currentUser && currentUser.role === 'admin') {
                    if (order.order_status === 'PENDING') {
                        orderActions = `
                            <button onclick="event.stopPropagation(); updateOrderStatus(${order.id}, 'PROCESSING')" 
                                    style="flex: 1; padding: 0.75rem; background: #4299e1; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.2s;"
                                    onmouseover="this.style.background='#3182ce';" onmouseout="this.style.background='#4299e1';">
                                 Start Processing
                            </button>
                        `;
                    } else if (order.order_status === 'PROCESSING') {
                        orderActions = `
                            <button onclick="event.stopPropagation(); updateOrderStatus(${order.id}, 'SHIPPED')" 
                                    style="flex: 1; padding: 0.75rem; background: #9f7aea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.2s;"
                                    onmouseover="this.style.background='#805ad5';" onmouseout="this.style.background='#9f7aea';">
                                 Mark as Shipped
                            </button>
                        `;
                    } else if (order.order_status === 'SHIPPED') {
                        orderActions = `
                            <button onclick="event.stopPropagation(); updateOrderStatus(${order.id}, 'DELIVERED')" 
                                    style="flex: 1; padding: 0.75rem; background: #48bb78; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.2s;"
                                    onmouseover="this.style.background='#38a169';" onmouseout="this.style.background='#48bb78';">
                                 Mark as Delivered
                            </button>
                            <button onclick="event.stopPropagation(); updateOrderStatus(${order.id}, 'CANCELLED')" 
                                    style="flex: 1; padding: 0.75rem; background: #f56565; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.2s;"
                                    onmouseover="this.style.background='#e53e3e';" onmouseout="this.style.background='#f56565';">
                                 Mark as Undelivered
                            </button>
                        `;
                    }
                }
                
                html += `
                    <div class="data-card" style="cursor: pointer; position: relative;" onclick="showOrderDetails(${order.id})">
                        ${order.payment_status === 'PENDING' ? `
                        <!-- Pulsing Alert Indicator -->
                        <div style="position: absolute; top: 1rem; left: 1rem; z-index: 10;">
                            <div style="width: 12px; height: 12px; background: #ef4444; border-radius: 50%; box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); animation: pulseAlert 2s infinite;"></div>
                        </div>
                        ` : ''}
                        <!-- Order Header -->
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(100, 116, 139, 0.3);">
                            <div>
                                <div style="font-size: 1.1rem; font-weight: 700; color: #f1f5f9; margin-bottom: 0.25rem;">${order.order_number || `Order #${order.id}`}</div>
                                <div style="font-size: 0.875rem; color: #94a3b8;">Placed on ${new Date(order.created_at || Date.now()).toLocaleDateString()}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #667eea; margin-bottom: 0.75rem;">$${parseFloat(order.order_total).toFixed(2)}</div>
                                    <div style="display: flex; flex-direction: column; gap: 0.5rem; align-items: flex-end;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="font-size: 0.75rem; color: #94a3b8; font-weight: 600; min-width: 60px; text-align: right;">Order:</span>
                                        <span class="status-badge status-${statusClass}">${order.order_status}</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="font-size: 0.75rem; color: #94a3b8; font-weight: 600; min-width: 60px; text-align: right;">Payment:</span>
                                        <span class="status-badge status-${paymentClass}">${order.payment_status}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Customer Info -->
                        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; padding: 0.75rem; background: rgba(30, 41, 59, 0.4); border-radius: 8px; border: 1px solid rgba(100, 116, 139, 0.2);">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1rem; flex-shrink: 0;">
                                ${customerDisplay.charAt(0).toUpperCase()}
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-weight: 600; color: #f1f5f9; font-size: 0.95rem;">${customerDisplay}</div>
                                <div style="font-size: 0.8rem; color: #60a5fa;">${order.customer_email || 'No email'}</div>
                            </div>
                        </div>
                        
                        <!-- Order Items -->
                        <div style="margin-bottom: 1rem;">
                            <div style="font-weight: 700; color: #cbd5e0; margin-bottom: 0.5rem; font-size: 0.9rem;">Items (${order.items?.length || 0})</div>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                ${itemsHtml || '<div style="color: #94a3b8; font-size: 0.875rem; padding: 1rem; text-align: center; background: rgba(30, 41, 59, 0.4); border-radius: 6px;">No items</div>'}
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        ${showPaymentActions || orderActions || order.payment_status === 'PENDING' ? `
                        <div style="display: flex; gap: 0.75rem; padding-top: 1rem; border-top: 1px solid rgba(100, 116, 139, 0.3); align-items: center; flex-wrap: wrap;" onclick="event.stopPropagation();">
                            ${showPaymentActions ? `
                                <button onclick="approvePayment(${order.id})"
                                        style="flex: 1; padding: 0.75rem; background: #48bb78; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.2s;"
                                        onmouseover="this.style.background='#38a169';" onmouseout="this.style.background='#48bb78';">
                                     Approve Payment
                                </button>
                                <button onclick="declinePayment(${order.id})" 
                                        style="flex: 1; padding: 0.75rem; background: #f56565; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.2s;"
                                        onmouseover="this.style.background='#e53e3e';" onmouseout="this.style.background='#f56565';">
                                     Decline Payment
                                </button>
                            ` : orderActions}
                            ${order.payment_status === 'PENDING' && currentUser && currentUser.role === 'admin' ? `
                                <button onclick="deleteOrder(${order.id})" 
                                        style="flex: 1; padding: 0.75rem; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.2s; min-width: 140px;"
                                        onmouseover="this.style.background='#dc2626';" onmouseout="this.style.background='#ef4444';">
                                     Delete Order
                                </button>
                            ` : ''}
                        </div>
                        ` : ''}
                    </div>
                `;
            });
            html += '</div>';
            
            // Add pagination
            if (totalPages > 1) {
                html += '<div class="pagination">';
                html += `<button class="pagination-button" onclick="changeOrdersPage(${ordersPage - 1})" ${ordersPage === 1 ? 'disabled' : ''}>Previous</button>`;
                
                // Smart page number display
                let startPage = Math.max(1, ordersPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);
                
                // Adjust if we're near the end
                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    html += `<button class="pagination-button ${ordersPage === i ? 'active' : ''}" onclick="changeOrdersPage(${i})">${i}</button>`;
                }
                
                if (endPage < totalPages) {
                    html += `<span class="pagination-info">...</span>`;
                    html += `<button class="pagination-button" onclick="changeOrdersPage(${totalPages})">${totalPages}</button>`;
                }
                
                html += `<button class="pagination-button" onclick="changeOrdersPage(${ordersPage + 1})" ${ordersPage === totalPages ? 'disabled' : ''}>Next</button>`;
                html += `<span class="pagination-info">Showing ${startIndex + 1}-${Math.min(endIndex, orders.length)} of ${orders.length}</span>`;
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        function changeOrdersPage(page) {
            const dataToUse = sortedOrdersData.length > 0 ? sortedOrdersData : window.ordersData;
            if (page < 1 || page > Math.ceil(dataToUse.length / ordersPerPage)) return;
            ordersPage = page;
            displayOrders(dataToUse);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Activity pagination state
        let activityPage = 1;
        const activityPerPage = 20; // Activities per page
        
        async function loadActivity() {
            try {
                const response = await fetch('/api/activity', {
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                const activities = await response.json();
                window.activitiesData = activities; // Store globally
                displayActivity(activities);
            } catch (error) {
                console.error('Failed to load activity:', error);
            }
        }
        
        function displayActivity(activities) {
            const container = document.getElementById('activityFeed');
            if (!activities || activities.length === 0) {
                container.innerHTML = '<div class="empty-state">No activity yet. Start creating customers, products, and orders!</div>';
                return;
            }
            
            // Pagination logic - paginate flat list first
            const totalPages = Math.ceil(activities.length / activityPerPage);
            // Safety check: if current page exceeds total pages, reset to last page
            if (activityPage > totalPages) {
                activityPage = totalPages;
            }
            const startIndex = (activityPage - 1) * activityPerPage;
            const endIndex = startIndex + activityPerPage;
            const paginatedActivities = activities.slice(startIndex, endIndex);
            
            // Group by user
            const byUser = {};
            paginatedActivities.forEach(activity => {
                if (!byUser[activity.user]) byUser[activity.user] = [];
                byUser[activity.user].push(activity);
            });
            
            let html = '<div style="max-width: 900px; margin: 0 auto;">';
            for (const [user, userActivities] of Object.entries(byUser)) {
                const userId = `user-${btoa(user).replace(/=/g,'')}`;
                html += `
                    <div class="activity-user-group" style="background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(10px); border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem; border-left: 4px solid #667eea; box-shadow: 0 4px 16px rgba(0,0,0,0.3); border: 1px solid rgba(100, 116, 139, 0.2);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="width: 45px; height: 45px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.25rem;">
                                ${user.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div style="font-weight: 600; color: #f1f5f9; font-size: 1.1rem;">${user}</div>
                                <div style="font-size: 0.875rem; color: #94a3b8;">${userActivities.length} activities</div>
                            </div>
                        </div>
                        <div style="border-left: 3px solid rgba(100, 116, 139, 0.4); margin-left: 22px; padding-left: 1.5rem;">
                `;
                
                userActivities.forEach((activity, idx) => {
                    const actionColors = {
                        'CREATE': { bg: 'rgba(34, 197, 94, 0.2)', color: '#86efac', border: 'rgba(34, 197, 94, 0.4)' },
                        'UPDATE': { bg: 'rgba(59, 130, 246, 0.2)', color: '#93c5fd', border: 'rgba(59, 130, 246, 0.4)' },
                        'DELETE': { bg: 'rgba(239, 68, 68, 0.2)', color: '#fca5a5', border: 'rgba(239, 68, 68, 0.4)' },
                        'PAYMENT': { bg: 'rgba(251, 191, 36, 0.2)', color: '#fcd34d', border: 'rgba(251, 191, 36, 0.4)' }
                    };
                    const colors = actionColors[activity.action] || { bg: 'rgba(100, 116, 139, 0.2)', color: '#cbd5e0', border: 'rgba(100, 116, 139, 0.4)' };
                    const timeAgo = formatTimeAgo(new Date(activity.timestamp));
                    
                    html += `
                        <div style="margin-bottom: 0.75rem; padding: 1rem; background: rgba(15, 23, 42, 0.6); border-radius: 8px; border-left: 3px solid ${colors.border}; border: 1px solid ${colors.border};">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <span style="padding: 0.35rem 0.75rem; background: ${colors.bg}; color: ${colors.color}; border-radius: 6px; font-size: 0.75rem; font-weight: 700; letter-spacing: 0.05em; border: 1px solid ${colors.border};">
                                        ${activity.action}
                                    </span>
                                    <span style="color: #f1f5f9; font-weight: 600;">
                                        ${activity.entity_type} #${activity.entity_id}
                                    </span>
                                </div>
                                <span style="font-size: 0.8rem; color: #94a3b8; white-space: nowrap;">${timeAgo}</span>
                            </div>
                            ${activity.details ? `
                                <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #cbd5e0; padding-left: 0.5rem;">
                                    ${activity.details}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                
                html += '</div></div>';
            }
            html += '</div>';
            
            // Add pagination
            if (totalPages > 1) {
                html += '<div class="pagination" style="margin-top: 2rem;">';
                html += `<button class="pagination-button" onclick="changeActivityPage(${activityPage - 1})" ${activityPage === 1 ? 'disabled' : ''}>Previous</button>`;
                
                // Smart page number display
                let startPage = Math.max(1, activityPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);
                
                // Adjust if we're near the end
                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    html += `<button class="pagination-button ${activityPage === i ? 'active' : ''}" onclick="changeActivityPage(${i})">${i}</button>`;
                }
                
                if (endPage < totalPages) {
                    html += `<span class="pagination-info">...</span>`;
                    html += `<button class="pagination-button" onclick="changeActivityPage(${totalPages})">${totalPages}</button>`;
                }
                
                html += `<button class="pagination-button" onclick="changeActivityPage(${activityPage + 1})" ${activityPage === totalPages ? 'disabled' : ''}>Next</button>`;
                html += `<span class="pagination-info">Showing ${startIndex + 1}-${Math.min(endIndex, activities.length)} of ${activities.length} activities</span>`;
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        function changeActivityPage(page) {
            if (!window.activitiesData) return;
            const totalPages = Math.ceil(window.activitiesData.length / activityPerPage);
            if (page < 1 || page > totalPages) return;
            activityPage = page;
            displayActivity(window.activitiesData);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function formatTimeAgo(date) {
            // Ensure we're comparing UTC to UTC
            const now = new Date();
            const activityDate = new Date(date);
            const seconds = Math.floor((now - activityDate) / 1000);
            
            if (seconds < 0) return 'just now';  // Handle future times
            if (seconds < 60) return `${seconds}s ago`;
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours}h ago`;
            const days = Math.floor(hours / 24);
            if (days === 1) return 'Yesterday';
            return `${days}d ago`;
        }

        async function loadShipments() {
            try {
                const response = await fetch('/api/shipments', {
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                const shipments = await response.json();
                window.shipmentsData = shipments; // Store globally
                filterAndDisplayShipments();
            } catch (error) {
                console.error('Failed to load shipments:', error);
            }
        }
        
        // Shipments pagination state
        let shipmentsPage = 1;
        const shipmentsPerPage = 10;
        let filteredShipmentsData = [];
        
        function filterAndDisplayShipments() {
            if (!window.shipmentsData) return;
            
            const statusFilter = document.getElementById('shipmentStatusFilter')?.value || 'all';
            const sortBy = document.getElementById('shipmentSortBy')?.value || 'id-desc';
            
            // Filter by status
            let filtered = [...window.shipmentsData];
            if (statusFilter !== 'all') {
                filtered = filtered.filter(s => s.status === statusFilter);
            }
            
            // Sort
            const [field, direction] = sortBy.split('-');
            filtered.sort((a, b) => {
                let aVal, bVal;
                if (field === 'id') {
                    aVal = a.id;
                    bVal = b.id;
                } else if (field === 'order') {
                    aVal = a.order_id;
                    bVal = b.order_id;
                }
                
                if (direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            filteredShipmentsData = filtered;
            shipmentsPage = 1;
            displayShipments(filtered);
        }
        
        function displayShipments(shipments) {
            const container = document.getElementById('shipmentsTable');
            if (!shipments || shipments.length === 0) {
                container.innerHTML = '<div class="empty-state">No shipments found. Shipments are created when orders are marked as shipped.</div>';
                return;
            }
            
            // Pagination logic
            const totalPages = Math.ceil(shipments.length / shipmentsPerPage);
            // Safety check: if current page exceeds total pages, reset to last page
            if (shipmentsPage > totalPages) {
                shipmentsPage = totalPages;
            }
            const startIndex = (shipmentsPage - 1) * shipmentsPerPage;
            const endIndex = startIndex + shipmentsPerPage;
            const paginatedShipments = shipments.slice(startIndex, endIndex);
            
            let html = '<div style="display: flex; flex-direction: column; gap: 1rem;">';
            paginatedShipments.forEach(shipment => {
                const statusColors = {
                    'PENDING': '#feebc8',
                    'IN_TRANSIT': '#bee3f8',
                    'DELIVERED': '#c6f6d5',
                    'CANCELLED': '#fed7d7'
                };
                const statusTextColors = {
                    'PENDING': '#7c2d12',
                    'IN_TRANSIT': '#2c5282',
                    'DELIVERED': '#22543d',
                    'CANCELLED': '#742a2a'
                };
                
                const statusColor = statusColors[shipment.status] || '#e2e8f0';
                const statusTextColor = statusTextColors[shipment.status] || '#4a5568';
                
                // Build items HTML
                let itemsHtml = '';
                if (shipment.items && shipment.items.length > 0) {
                    const displayItems = shipment.items.slice(0, 2);
                    displayItems.forEach(item => {
                        itemsHtml += `
                            <div style="display: flex; gap: 0.75rem; padding: 0.75rem; background: rgba(30, 41, 59, 0.4); border-radius: 6px; margin-bottom: 0.5rem; border: 1px solid rgba(100, 116, 139, 0.2);">
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; font-size: 0.9rem; color: #f1f5f9;">${item.product_name}</div>
                                    <div style="font-size: 0.8rem; color: #94a3b8; margin-top: 0.25rem;">SKU: ${item.sku} | Qty: ${item.quantity}</div>
                                    ${item.seller_name ? `<div style="font-size: 0.75rem; color: #60a5fa; margin-top: 0.25rem;">Seller: ${item.seller_name}</div>` : ''}
                                </div>
                            </div>
                        `;
                    });
                    if (shipment.items.length > 2) {
                        itemsHtml += `<div style="text-align: center; font-size: 0.875rem; color: #667eea;">+${shipment.items.length - 2} more items</div>`;
                    }
                }
                
                // Format address
                const addr = shipment.shipping_address;
                const addressHtml = addr ? `${addr.street || ''}, ${addr.city || ''}, ${addr.state || ''} ${addr.zip || ''}, ${addr.country || ''}` : 'Address not available';
                
                html += `
                    <div class="data-card" style="position: relative;">
                        ${shipment.status === 'IN_TRANSIT' ? `
                        <!-- Pulsing Transit Indicator -->
                        <div style="position: absolute; top: 1rem; left: 1rem; z-index: 10;">
                            <div style="width: 12px; height: 12px; background: #f59e0b; border-radius: 50%; box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); animation: pulseTransit 2s infinite;"></div>
                        </div>
                        ` : ''}
                        <!-- Shipment Header -->
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(100, 116, 139, 0.3);">
                            <div>
                                <div style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 0.25rem;">Shipment #${shipment.id} | ${shipment.order_number || `Order #${shipment.order_id}`}</div>
                                <div style="font-size: 1rem; font-weight: 600; color: #f1f5f9;">${shipment.customer_name || `Customer #${shipment.customer_id || 'N/A'}`}</div>
                                <div style="font-size: 0.875rem; color: #60a5fa;">${shipment.customer_email || ''}</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="display: inline-block; padding: 0.5rem 1rem; background: ${statusColor}; color: ${statusTextColor}; border-radius: 8px; font-weight: 600; font-size: 0.875rem; margin-bottom: 0.5rem;">
                                    ${shipment.status.replace('_', ' ')}
                                </div>
                                <div style="font-size: 0.875rem; color: #94a3b8;">
                                    ${shipment.tracking_no ? `Tracking: <strong style="color: #f1f5f9;">${shipment.tracking_no}</strong>` : 'Tracking: Pending'}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Shipment Info Grid -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <div style="font-size: 0.75rem; color: #cbd5e0; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; font-weight: 700;">Shipping Address</div>
                                <div style="font-size: 0.875rem; color: #e2e8f0; line-height: 1.5;">${addressHtml}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.75rem; color: #cbd5e0; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem; font-weight: 700;">Delivery Info</div>
                                <div style="font-size: 0.875rem; color: #e2e8f0;">
                                    ${shipment.carrier ? `<div><strong style="color: #f1f5f9;">Carrier:</strong> ${shipment.carrier}</div>` : ''}
                                    ${shipment.shipped_at ? `<div><strong style="color: #f1f5f9;">Shipped:</strong> ${new Date(shipment.shipped_at).toLocaleDateString()}</div>` : ''}
                                    ${shipment.delivered_at ? `<div><strong style="color: #f1f5f9;">Delivered:</strong> ${new Date(shipment.delivered_at).toLocaleDateString()}</div>` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Order Items -->
                        ${itemsHtml ? `
                        <div>
                            <div style="font-weight: 700; color: #cbd5e0; margin-bottom: 0.5rem; font-size: 0.9rem;">Items (${shipment.items?.length || 0})</div>
                            ${itemsHtml}
                        </div>
                        ` : ''}
                    </div>
                `;
            });
            html += '</div>';
            
            // Add pagination
            if (totalPages > 1) {
                html += '<div class="pagination">';
                html += `<button class="pagination-button" onclick="changeShipmentsPage(${shipmentsPage - 1})" ${shipmentsPage === 1 ? 'disabled' : ''}>Previous</button>`;
                
                // Smart page number display
                let startPage = Math.max(1, shipmentsPage - 2);
                let endPage = Math.min(totalPages, startPage + 4);
                
                // Adjust if we're near the end
                if (endPage - startPage < 4) {
                    startPage = Math.max(1, endPage - 4);
                }
                
                for (let i = startPage; i <= endPage; i++) {
                    html += `<button class="pagination-button ${shipmentsPage === i ? 'active' : ''}" onclick="changeShipmentsPage(${i})">${i}</button>`;
                }
                
                if (endPage < totalPages) {
                    html += `<span class="pagination-info">...</span>`;
                    html += `<button class="pagination-button" onclick="changeShipmentsPage(${totalPages})">${totalPages}</button>`;
                }
                
                html += `<button class="pagination-button" onclick="changeShipmentsPage(${shipmentsPage + 1})" ${shipmentsPage === totalPages ? 'disabled' : ''}>Next</button>`;
                html += `<span class="pagination-info">Showing ${startIndex + 1}-${Math.min(endIndex, shipments.length)} of ${shipments.length}</span>`;
                html += '</div>';
            }
            
            container.innerHTML = html;
        }
        
        function changeShipmentsPage(page) {
            if (!filteredShipmentsData || filteredShipmentsData.length === 0) return;
            const totalPages = Math.ceil(filteredShipmentsData.length / shipmentsPerPage);
            if (page < 1 || page > totalPages) return;
            shipmentsPage = page;
            displayShipments(filteredShipmentsData);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function formatAddress(address) {
            if (!address) return 'N/A';
            return `${address.street || ''}, ${address.city || ''}, ${address.state || ''} ${address.zip_code || ''}`;
        }
        
        // Delete functions
        async function deleteCustomer(customerId) {
            // Guests cannot delete customers
            if (currentUser && currentUser.role === 'guest') {
                alert('Admin access required to delete customers');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete Customer #${customerId}? This action cannot be undone.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/customers/${customerId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('Customer deleted successfully');
                    loadCustomers();
                } else {
                    alert('Failed to delete customer: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Error deleting customer: ' + error.message);
            }
        }
        
        async function deleteProduct(productId) {
            // Guests cannot delete products
            if (currentUser && currentUser.role === 'guest') {
                alert('Admin access required to delete products');
                return;
            }
            
            if (!confirm(`Are you sure you want to delete Product #${productId}? This action cannot be undone.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/products/${productId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('Product deleted successfully');
                    loadProducts();
                } else {
                    alert('Failed to delete product: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Error deleting product: ' + error.message);
            }
        }
        
        async function deleteOrder(orderId) {
            if (!confirm(`Are you sure you want to cancel Order #${orderId}? This action cannot be undone.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/orders/${orderId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                
                const result = await response.json();
                if (result.success) {
                    alert('Order cancelled successfully');
                    loadOrders();
                } else {
                    alert('Failed to cancel order: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Error cancelling order: ' + error.message);
            }
        }
        
        // Edit functions
        function editCustomer(customerId) {
            // Guests cannot edit customers
            if (currentUser && currentUser.role === 'guest') {
                alert('Admin access required to edit customers');
                return;
            }
            
            const customer = window.customersData.find(c => c.id === customerId);
            if (!customer) {
                alert('Customer not found');
                return;
            }
            
            document.getElementById('editCustomerId').value = customer.id;
            document.getElementById('editCustomerName').value = customer.name;
            
            // Split email into username and domain
            const email = customer.email || '';
            const emailParts = email.split('@');
            document.getElementById('editEmailUsername').value = emailParts[0] || '';
            if (emailParts[1]) {
                document.getElementById('editEmailDomain').value = emailParts[1];
            }
            
            // Split phone into country code and number
            const phone = customer.phone || '';
            if (phone) {
                // Extract country code (format: +XX... or +XXX... with optional space)
                const codeMatch = phone.match(/^(\+\d{1,3})\s*(.*)$/);
                if (codeMatch) {
                    document.getElementById('editCountryCode').value = codeMatch[1];
                    document.getElementById('editPhoneNumber').value = codeMatch[2];
                } else {
                    document.getElementById('editPhoneNumber').value = phone;
                }
            }
            
            document.getElementById('editCustomerStreet').value = customer.address_street || '';
            document.getElementById('editCustomerZip').value = customer.address_zip || '';
            
            // Set country and populate cities
            const country = customer.address_country || 'USA';
            document.getElementById('editCustomerCountry').value = country;
            updateCityOptions('edit');
            
            // Set city and state after options are populated
            setTimeout(() => {
                document.getElementById('editCustomerCity').value = customer.address_city || '';
                document.getElementById('editCustomerState').value = customer.address_state || '';
            }, 10);
            
            document.getElementById('editCustomerModal').classList.add('active');
        }
        
        function editProduct(productId) {
            // Guests cannot edit products
            if (currentUser && currentUser.role === 'guest') {
                alert('Admin access required to edit products');
                return;
            }
            
            const product = window.productsData.find(p => p.id === productId);
            if (!product) {
                alert('Product not found');
                return;
            }
            
            document.getElementById('editProductId').value = product.id;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductSKU').value = product.sku;
            document.getElementById('editProductDescription').value = product.description || '';
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductStock').value = product.stock_quantity || 0;
            
            // Populate seller fields
            document.getElementById('editProductSellerName').value = product.seller_name || '';
            document.getElementById('editProductSellerLocation').value = product.seller_location || '';
            document.getElementById('editProductSellerBadge').value = product.seller_badge || '';
            document.getElementById('editProductResponseTime').value = product.seller_response_time || '';
            
            // Handle category dropdown - check if it's a predefined category
            const categorySelect = document.getElementById('editProductCategory');
            const customInput = document.getElementById('editCustomCategoryInput');
            const customGroup = document.getElementById('editCustomCategoryGroup');
            const priceInput = document.getElementById('editProductPrice');
            const category = product.category || '';
            
            // Check if category exists in dropdown
            let foundCategory = false;
            for (let option of categorySelect.options) {
                if (option.value === category) {
                    categorySelect.value = category;
                    foundCategory = true;
                    break;
                }
            }
            
            // If not found, it's a custom category
            if (!foundCategory && category) {
                categorySelect.value = 'Custom';
                customGroup.style.display = 'block';
                customInput.value = category;
                customInput.required = true;
            } else if (!foundCategory) {
                categorySelect.value = '';
            }
            
            
            document.getElementById('editProductModal').classList.add('active');
        }

        function switchTab(tabName) {
            currentTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            // Load data for the tab
            if (tabName === 'customers') loadCustomers();
            else if (tabName === 'products') loadProducts();
            else if (tabName === 'orders') loadOrders();
            else if (tabName === 'shipments') loadShipments();
            else if (tabName === 'activity') loadActivity();
        }

        function showCreateCustomerModal() {
            if (currentUser.role !== 'admin') {
                alert('Admin access required');
                return;
            }
            document.getElementById('createCustomerModal').classList.add('active');
        }

        function showCreateProductModal() {
            if (currentUser.role !== 'admin') {
                alert('Admin access required');
                return;
            }
            document.getElementById('createProductModal').classList.add('active');
        }

        // Cart state
        let orderCart = [];
        let availableCustomers = [];
        let availableProducts = [];

        async function showCreateOrderModal() {
            if (currentUser.role !== 'admin') {
                alert('Admin access required');
                return;
            }
            
            // Load customers and products
            try {
                const [customersResp, productsResp] = await Promise.all([
                    fetch('/api/customers', { headers: { 'Authorization': `Basic ${authCredentials}` } }),
                    fetch('/api/products', { headers: { 'Authorization': `Basic ${authCredentials}` } })
                ]);
                
                availableCustomers = await customersResp.json();
                availableProducts = await productsResp.json();
                
                // Populate dropdowns
                const customerSelect = document.getElementById('orderCustomerSelect');
                customerSelect.innerHTML = '<option value="">-- Choose a customer --</option>';
                availableCustomers.forEach(c => {
                    customerSelect.innerHTML += `<option value="${c.id}">${c.name} (${c.email || 'no email'})</option>`;
                });
                
                const productSelect = document.getElementById('orderProductSelect');
                productSelect.innerHTML = '<option value="">-- Choose a product --</option>';
                availableProducts.forEach(p => {
                    const inStock = (p.stock_quantity || 0) > 0;
                    const sellerInfo = p.seller_name ? `  Seller: ${p.seller_name}` : '';
                    const shippingInfo = p.seller_shipping_policy ? `  ${p.seller_shipping_policy.split('within')[1] || 'Quick shipping'}` : '';
                    productSelect.innerHTML += `<option value="${p.id}" ${!inStock ? 'disabled' : ''}>` +
                        `${p.name} - $${parseFloat(p.price).toFixed(2)} ` +
                        `(${inStock ? p.stock_quantity + ' in stock' : 'Out of stock'})` +
                        `${sellerInfo}${shippingInfo}</option>`;
                });
                
                // Reset cart
                orderCart = [];
                updateCartDisplay();
                
                document.getElementById('createOrderModal').classList.add('active');
                
                // Initialize Choices.js for searchable dropdowns
                setTimeout(() => {
                    if (window.customerChoices) window.customerChoices.destroy();
                    if (window.productChoices) window.productChoices.destroy();
                    
                    window.customerChoices = new Choices('#orderCustomerSelect', {
                        searchEnabled: true,
                        searchPlaceholderValue: 'Search customers...',
                        itemSelectText: '',
                        shouldSort: false,
                        classNames: {
                            containerOuter: 'choices choices-dark'
                        }
                    });
                    
                    window.productChoices = new Choices('#orderProductSelect', {
                        searchEnabled: true,
                        searchPlaceholderValue: 'Search products...',
                        itemSelectText: '',
                        shouldSort: false,
                        classNames: {
                            containerOuter: 'choices choices-dark'
                        }
                    });
                }, 100);
            } catch (error) {
                alert('Failed to load data for order creation');
            }
        }
        
        function addProductToCart() {
            const productId = parseInt(document.getElementById('orderProductSelect').value);
            const quantity = parseInt(document.getElementById('orderProductQty').value) || 1;
            
            if (!productId) {
                alert('Please select a product');
                return;
            }
            
            const product = availableProducts.find(p => p.id === productId);
            if (!product) return;
            
            // Check if product already in cart
            const existingItem = orderCart.find(item => item.product_id === productId);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                orderCart.push({
                    product_id: productId,
                    product_name: product.name,
                    sku: product.sku,
                    unit_price: parseFloat(product.price),
                    quantity: quantity
                });
            }
            
            updateCartDisplay();
            
            // Reset selections
            if (window.productChoices) {
                window.productChoices.setChoiceByValue('');
            } else {
                document.getElementById('orderProductSelect').value = '';
            }
            document.getElementById('orderProductQty').value = '1';
        }
        
        function removeFromCart(index) {
            orderCart.splice(index, 1);
            updateCartDisplay();
        }
        
        function updateCartQuantity(index, newQty) {
            if (newQty < 1) {
                removeFromCart(index);
            } else {
                orderCart[index].quantity = newQty;
                updateCartDisplay();
            }
        }
        
        function updateCartDisplay() {
            const cartContainer = document.getElementById('cartItems');
            
            if (orderCart.length === 0) {
                cartContainer.innerHTML = '<div style="text-align: center; padding: 2rem; color: #94a3b8;">No items in cart. Add products above.</div>';
                document.getElementById('submitOrderBtn').disabled = true;
                document.getElementById('orderSubtotal').textContent = '$0.00';
                document.getElementById('orderTotal').textContent = '$0.00';
                return;
            }
            
            let html = '';
            let total = 0;
            
            orderCart.forEach((item, index) => {
                const itemTotal = item.quantity * item.unit_price;
                total += itemTotal;
                
                html += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 8px; margin-bottom: 0.5rem; backdrop-filter: blur(10px);">
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: #f1f5f9;">${item.product_name}</div>
                            <div style="font-size: 0.875rem; color: #94a3b8;">SKU: ${item.sku} | $${item.unit_price.toFixed(2)} each</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <input type="number" value="${item.quantity}" min="1" 
                                   onchange="updateCartQuantity(${index}, parseInt(this.value))" 
                                   style="width: 70px; padding: 0.5rem; border: 1px solid rgba(100, 116, 139, 0.4); border-radius: 4px; text-align: center; background: rgba(15, 23, 42, 0.5); color: #e2e8f0;">
                            <div style="min-width: 80px; text-align: right; font-weight: 700; color: #60a5fa;">
                                $${itemTotal.toFixed(2)}
                            </div>
                            <button onclick="removeFromCart(${index})" 
                                    style="padding: 0.5rem; background: #f56565; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                
                            </button>
                        </div>
                    </div>
                `;
            });
            
            cartContainer.innerHTML = html;
            document.getElementById('orderSubtotal').textContent = `$${total.toFixed(2)}`;
            document.getElementById('orderTotal').textContent = `$${total.toFixed(2)}`;
            
            // Enable submit if cart has items and customer selected
            const customerSelected = document.getElementById('orderCustomerSelect').value;
            document.getElementById('submitOrderBtn').disabled = !customerSelected;
        }
        
        // Update submit button state when customer changes
        document.addEventListener('DOMContentLoaded', () => {
            const customerSelect = document.getElementById('orderCustomerSelect');
            if (customerSelect) {
                customerSelect.addEventListener('change', () => {
                    const hasItems = orderCart.length > 0;
                    const hasCustomer = customerSelect.value !== '';
                    document.getElementById('submitOrderBtn').disabled = !(hasItems && hasCustomer);
                });
            }
        });
        
        async function submitOrder() {
            const customerId = parseInt(document.getElementById('orderCustomerSelect').value);
            
            if (!customerId || orderCart.length === 0) {
                alert('Please select a customer and add products to cart');
                return;
            }
            
            const orderData = {
                customer_id: customerId,
                items: orderCart.map(item => ({
                    product_id: item.product_id,
                    sku: item.sku,
                    quantity: item.quantity,
                    unit_price: item.unit_price
                }))
            };
            
            try {
                document.getElementById('submitOrderBtn').disabled = true;
                document.getElementById('submitOrderBtn').textContent = 'Creating...';
                
                const response = await fetch('/api/orders', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Basic ${authCredentials}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`Order #${result.data.id} created successfully! Total: $${parseFloat(result.data.order_total).toFixed(2)}`);
                    closeModal('createOrderModal');
                    loadOrders();
                } else {
                    alert('Failed to create order: ' + result.error);
                    document.getElementById('submitOrderBtn').disabled = false;
                    document.getElementById('submitOrderBtn').textContent = 'Create Order';
                }
            } catch (error) {
                alert('Error creating order: ' + error.message);
                document.getElementById('submitOrderBtn').disabled = false;
                document.getElementById('submitOrderBtn').textContent = 'Create Order';
            }
        }

        async function createQuickOrder() {
            try {
                const response = await fetch('/api/create_order', {
                    method: 'POST',
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                const result = await response.json();
                if (result.success) {
                    alert(`Order created: ID ${result.order_id}`);
                    loadOrders();
                } else {
                    alert('Failed to create order: ' + result.error);
                }
            } catch (error) {
                alert('Error creating order');
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // Form submissions
        document.getElementById('createCustomerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Combine email fields
            const emailUsername = document.getElementById('createEmailUsername').value;
            const emailDomain = document.getElementById('createEmailDomain').value;
            document.getElementById('createEmailFull').value = `${emailUsername}@${emailDomain}`;
            
            // Combine phone fields with space
            const countryCode = document.getElementById('createCountryCode').value;
            const phoneNumber = document.getElementById('createPhoneNumber').value;
            if (phoneNumber) {
                document.getElementById('createPhoneFull').value = `${countryCode} ${phoneNumber}`;
            }
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            try {
                const response = await fetch('/api/customers', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Basic ${authCredentials}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (result.success) {
                    closeModal('createCustomerModal');
                    e.target.reset();
                    loadCustomers();
                    alert('Customer created successfully');
                } else {
                    document.getElementById('customerFormMessage').innerHTML = 
                        `<div class="message error">${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('customerFormMessage').innerHTML = 
                    `<div class="message error">Failed to create customer</div>`;
            }
        });

        document.getElementById('createProductForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);
            
            // Handle custom category
            const categorySelect = document.getElementById('createProductCategory');
            if (categorySelect.value === 'Custom') {
                data.category = document.getElementById('createCustomCategoryInput').value;
            }

            try {
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Basic ${authCredentials}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (result.success) {
                    closeModal('createProductModal');
                    e.target.reset();
                    document.getElementById('createCustomCategoryGroup').style.display = 'none';
                    loadProducts();
                    alert('Product created successfully');
                } else {
                    // Handle error message properly
                    let errorMsg = 'Failed to create product';
                    if (typeof result.error === 'string') {
                        errorMsg = result.error;
                    } else if (result.error && typeof result.error === 'object') {
                        errorMsg = JSON.stringify(result.error, null, 2);
                    }
                    document.getElementById('productFormMessage').innerHTML = 
                        `<div class="message error">${errorMsg}</div>`;
                }
            } catch (error) {
                document.getElementById('productFormMessage').innerHTML = 
                    `<div class="message error">Failed to create product: ${error.message}</div>`;
            }
        });
        
        // Edit form submissions
        document.getElementById('editCustomerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Combine email fields
            const emailUsername = document.getElementById('editEmailUsername').value;
            const emailDomain = document.getElementById('editEmailDomain').value;
            const fullEmail = `${emailUsername}@${emailDomain}`;
            
            // Combine phone fields with space
            const countryCode = document.getElementById('editCountryCode').value;
            const phoneNumber = document.getElementById('editPhoneNumber').value;
            const fullPhone = phoneNumber ? `${countryCode} ${phoneNumber}` : '';
            
            const customerId = document.getElementById('editCustomerId').value;
            const data = {
                name: document.getElementById('editCustomerName').value,
                email: fullEmail,
                phone: fullPhone,
                address_street: document.getElementById('editCustomerStreet').value,
                address_city: document.getElementById('editCustomerCity').value,
                address_state: document.getElementById('editCustomerState').value,
                address_zip: document.getElementById('editCustomerZip').value,
                address_country: document.getElementById('editCustomerCountry').value
            };

            try {
                const response = await fetch(`/api/customers/${customerId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Basic ${authCredentials}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (result.success) {
                    closeModal('editCustomerModal');
                    loadCustomers();
                    alert('Customer updated successfully');
                } else {
                    document.getElementById('editCustomerMessage').innerHTML = 
                        `<div class="message error">${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('editCustomerMessage').innerHTML = 
                    `<div class="message error">Failed to update customer: ${error.message}</div>`;
            }
        });

        document.getElementById('editProductForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const productId = document.getElementById('editProductId').value;
            
            // Handle custom category
            const categorySelect = document.getElementById('editProductCategory');
            let category = categorySelect.value;
            if (category === 'Custom') {
                category = document.getElementById('editCustomCategoryInput').value;
            }
            
            const data = {
                name: document.getElementById('editProductName').value,
                sku: document.getElementById('editProductSKU').value,
                description: document.getElementById('editProductDescription').value || null,
                category: category,
                price: parseFloat(document.getElementById('editProductPrice').value),
                stock_quantity: parseInt(document.getElementById('editProductStock').value),
                seller_name: document.getElementById('editProductSellerName').value || null,
                seller_location: document.getElementById('editProductSellerLocation').value || null,
                seller_badge: document.getElementById('editProductSellerBadge').value || null,
                seller_response_time: document.getElementById('editProductResponseTime').value || null
            };

            try {
                const response = await fetch(`/api/products/${productId}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Basic ${authCredentials}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                if (result.success) {
                    closeModal('editProductModal');
                    loadProducts();
                    alert('Product updated successfully');
                } else {
                    document.getElementById('editProductMessage').innerHTML = 
                        `<div class="message error">${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('editProductMessage').innerHTML = 
                    `<div class="message error">Failed to update product: ${error.message}</div>`;
            }
        });

        // Order detail modal functions
        function showOrderDetails(orderId) {
            const order = window.ordersData.find(o => o.id === orderId);
            if (!order) {
                alert('Order not found');
                return;
            }
            
            let itemsHtml = '';
            let totalPrice = 0;
            
            if (order.items && order.items.length > 0) {
                order.items.forEach(item => {
                    const itemTotal = item.quantity * item.unit_price;
                    totalPrice += itemTotal;
                    itemsHtml += `
                        <div style="display: flex; justify-content: space-between; align-items: start; padding: 1.25rem; background: rgba(30, 41, 59, 0.4); border-radius: 8px; margin-bottom: 0.75rem; border: 1px solid rgba(100, 116, 139, 0.3);">
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-weight: 600; color: #f1f5f9; font-size: 1rem; margin-bottom: 0.5rem;">${item.product_name}</div>
                                <div style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 0.5rem;">SKU: ${item.product_sku}</div>
                                ${item.seller_name ? `
                                    <div style="font-size: 0.875rem; color: #60a5fa; margin-bottom: 0.25rem;">Seller: ${item.seller_name}</div>
                                    ${item.seller_location ? `<div style="font-size: 0.8rem; color: #94a3b8;">Ships from: ${item.seller_location}</div>` : ''}
                                ` : ''}
                                <div style="font-size: 0.875rem; color: #cbd5e0; margin-top: 0.5rem;">Quantity: ${item.quantity}  $${parseFloat(item.unit_price).toFixed(2)}</div>
                            </div>
                            <div style="font-weight: 700; color: #60a5fa; font-size: 1.125rem; white-space: nowrap; margin-left: 1rem;">$${itemTotal.toFixed(2)}</div>
                        </div>
                    `;
                });
            }
            
            // Order timeline based on status
            const orderDate = new Date(order.created_at || Date.now());
            const isCancelled = order.order_status === 'CANCELLED';
            
            let timelineHtml = `
                <div style="margin: 1.5rem 0; padding: 1.25rem; background: rgba(30, 41, 59, 0.4); border-radius: 8px; border-left: 4px solid ${isCancelled ? '#f56565' : '#667eea'}; border: 1px solid rgba(100, 116, 139, 0.3);">
                    <div style="font-weight: 700; color: #f1f5f9; margin-bottom: 1rem; font-size: 1rem;">Order Timeline</div>
                    <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="width: 32px; height: 32px; border-radius: 50%; background: #48bb78; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; flex-shrink: 0;">
                                
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #f1f5f9; font-size: 0.9rem;">Order Placed</div>
                                <div style="font-size: 0.8rem; color: #94a3b8;">${orderDate.toLocaleString()}</div>
                            </div>
                        </div>
                        ${isCancelled ? `
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 32px; height: 32px; border-radius: 50%; background: #f56565; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; flex-shrink: 0;">
                                    
                                </div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: #f1f5f9; font-size: 0.9rem;">Order Cancelled</div>
                                    <div style="font-size: 0.8rem; color: #94a3b8;">Payment declined or order cancelled</div>
                                </div>
                            </div>
                        ` : ['PROCESSING', 'SHIPPED', 'DELIVERED'].map(status => {
                            const isComplete = ['PROCESSING', 'SHIPPED', 'DELIVERED'].indexOf(order.order_status) >= ['PROCESSING', 'SHIPPED', 'DELIVERED'].indexOf(status);
                            const icon = isComplete ? '' : '';
                            const bgColor = isComplete ? '#48bb78' : '#cbd5e0';
                            const statusText = status.charAt(0) + status.slice(1).toLowerCase();
                            return `
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; background: ${bgColor}; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; flex-shrink: 0;">
                                        ${icon}
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: #f1f5f9; font-size: 0.9rem;">${statusText}</div>
                                        <div style="font-size: 0.8rem; color: #94a3b8;">${isComplete && order.order_status === status ? 'Current status' : isComplete ? 'Completed' : 'Pending'}</div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            // Admin actions - only show for pending payment or incomplete orders
            let adminActionsHtml = '';
            const showAdminActions = currentUser && currentUser.role === 'admin' && 
                (order.payment_status === 'PENDING' || 
                 (order.payment_status === 'COMPLETED' && ['PENDING', 'PROCESSING', 'SHIPPED'].includes(order.order_status)));
            
            if (showAdminActions) {
                adminActionsHtml = '<div style="margin-top: 1.5rem; padding: 1.25rem; background: rgba(251, 191, 36, 0.1); border-radius: 8px; border: 1px solid rgba(251, 191, 36, 0.3);">';
                adminActionsHtml += '<div style="font-weight: 600; color: #fcd34d; margin-bottom: 0.75rem;">Admin Actions</div>';
                adminActionsHtml += '<div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">';
                
                if (order.payment_status === 'PENDING') {
                    adminActionsHtml += `
                        <button onclick="approvePayment(${order.id})" 
                                style="padding: 0.75rem 1.25rem; background: #48bb78; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                             Approve Payment
                        </button>
                        <button onclick="declinePayment(${order.id})" 
                                style="padding: 0.75rem 1.25rem; background: #f56565; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                             Decline Payment
                        </button>
                        <button onclick="deleteOrder(${order.id})" 
                                style="padding: 0.75rem 1.25rem; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                            Delete Order
                        </button>
                    `;
                }
                
                if (order.payment_status === 'COMPLETED') {
                    if (order.order_status === 'PENDING') {
                        adminActionsHtml += `
                            <button onclick="updateOrderStatus(${order.id}, 'PROCESSING')" 
                                    style="padding: 0.75rem 1.25rem; background: #4299e1; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                 Start Processing
                            </button>
                        `;
                    } else if (order.order_status === 'PROCESSING') {
                        adminActionsHtml += `
                            <button onclick="updateOrderStatus(${order.id}, 'SHIPPED')" 
                                    style="padding: 0.75rem 1.25rem; background: #9f7aea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                 Mark as Shipped
                            </button>
                        `;
                    } else if (order.order_status === 'SHIPPED') {
                        adminActionsHtml += `
                            <button onclick="updateOrderStatus(${order.id}, 'DELIVERED')" 
                                    style="padding: 0.75rem 1.25rem; background: #48bb78; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                 Mark as Delivered
                            </button>
                            <button onclick="updateOrderStatus(${order.id}, 'CANCELLED')" 
                                    style="padding: 0.75rem 1.25rem; background: #f56565; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                 Mark as Undelivered
                            </button>
                        `;
                    }
                }
                
                adminActionsHtml += '</div></div>';
            }
            
            const modalContent = `
                <div style="padding: 0.5rem 0;">
                    <!-- Order Info -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; margin-bottom: 1.5rem; padding: 1.25rem; background: rgba(30, 41, 59, 0.4); border-radius: 8px; border: 1px solid rgba(100, 116, 139, 0.3);">
                        <div>
                            <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #cbd5e0; margin-bottom: 0.5rem; font-weight: 700;">Customer</div>
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 45px; height: 45px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.125rem;">
                                    ${order.customer_name?.charAt(0).toUpperCase() || 'C'}
                                </div>
                                <div>
                                    <div style="font-weight: 600; color: #f1f5f9;">${order.customer_name}</div>
                                    <div style="font-size: 0.875rem; color: #60a5fa;">${order.customer_email}</div>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #cbd5e0; margin-bottom: 0.5rem; font-weight: 700;">Status</div>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 0.75rem; color: #94a3b8; font-weight: 600; min-width: 60px;">Order:</span>
                                    <span class="status-badge status-${order.order_status.toLowerCase()}">${order.order_status}</span>
                                </div>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 0.75rem; color: #94a3b8; font-weight: 600; min-width: 60px;">Payment:</span>
                                    <span class="status-badge status-${order.payment_status.toLowerCase()}">${order.payment_status}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    ${timelineHtml}
                    
                    <h4 style="margin: 1.5rem 0 1rem; color: #f1f5f9; font-size: 1.125rem; font-weight: 700;">Order Items</h4>
                    ${itemsHtml}
                    
                    <div style="margin-top: 1.5rem; padding: 1.25rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="color: white; font-size: 1.125rem; font-weight: 600;">Order Total</span>
                            <span style="color: white; font-size: 1.75rem; font-weight: 700;">$${parseFloat(order.order_total).toFixed(2)}</span>
                        </div>
                    </div>
                    
                    ${order.payment_status === 'COMPLETED' && order.order_status !== 'CANCELLED' ? `
                    <div style="margin-top: 1rem; padding: 1.25rem; background: rgba(34, 197, 94, 0.15); border: 1px solid rgba(34, 197, 94, 0.4); border-radius: 8px; position: relative; overflow: hidden;">
                        <!-- Flying Money with Wings Background -->
                        <div style="position: absolute; top: 50%; right: 1rem; transform: translateY(-50%); opacity: 0.5; filter: drop-shadow(0 4px 12px rgba(72, 187, 120, 0.5)); will-change: transform;">
                            <svg width="140" height="100" viewBox="0 0 140 100" style="animation: flyingMoney 4s ease-in-out infinite; will-change: transform;">
                                <!-- Left Wing (Angel Style) -->
                                <g style="transform-origin: 35px 50px; animation: flapWingLeft 0.5s ease-in-out infinite;">
                                    <!-- Primary feathers (long) -->
                                    <path d="M 35 50 Q 15 30 5 25 Q 3 35 10 40 Q 20 45 35 50" fill="#48bb78" stroke="#22543d" stroke-width="2"/>
                                    <path d="M 35 50 Q 15 45 8 42 Q 8 50 15 52 Q 25 52 35 50" fill="#5ed68a" stroke="#22543d" stroke-width="1.5"/>
                                    <path d="M 35 50 Q 18 52 12 55 Q 12 62 18 62 Q 28 58 35 50" fill="#86efac" stroke="#22543d" stroke-width="1.5"/>
                                    <!-- Secondary feathers (shorter) -->
                                    <path d="M 35 50 Q 22 58 18 65 Q 20 70 26 68 Q 32 62 35 50" fill="#a0f0c0" stroke="#22543d" stroke-width="1"/>
                                </g>
                                
                                <!-- Currency Note Body -->
                                <g>
                                    <rect x="35" y="35" width="65" height="35" rx="6" fill="#48bb78" stroke="#22543d" stroke-width="3"/>
                                    <rect x="38" y="38" width="59" height="29" rx="4" fill="#38a169" opacity="0.5"/>
                                    
                                    <!-- Bill details -->
                                    <line x1="42" y1="44" x2="92" y2="44" stroke="#86efac" stroke-width="1.5" opacity="0.6"/>
                                    <line x1="42" y1="61" x2="92" y2="61" stroke="#86efac" stroke-width="1.5" opacity="0.6"/>
                                    
                                    <!-- Large Dollar Sign -->
                                    <text x="67.5" y="57" font-size="26" font-weight="bold" fill="#e6ffed" text-anchor="middle" font-family="Arial, sans-serif" stroke="#22543d" stroke-width="0.5">$</text>
                                    
                                    <!-- Corner decorations -->
                                    <circle cx="43" cy="43" r="4" fill="#86efac" stroke="#22543d" stroke-width="1"/>
                                    <circle cx="92" cy="43" r="4" fill="#86efac" stroke="#22543d" stroke-width="1"/>
                                    <circle cx="43" cy="62" r="4" fill="#86efac" stroke="#22543d" stroke-width="1"/>
                                    <circle cx="92" cy="62" r="4" fill="#86efac" stroke="#22543d" stroke-width="1"/>
                                </g>
                                
                                <!-- Right Wing (Angel Style) -->
                                <g style="transform-origin: 100px 50px; animation: flapWingRight 0.5s ease-in-out infinite;">
                                    <!-- Primary feathers (long) -->
                                    <path d="M 100 50 Q 120 30 130 25 Q 132 35 125 40 Q 115 45 100 50" fill="#48bb78" stroke="#22543d" stroke-width="2"/>
                                    <path d="M 100 50 Q 120 45 127 42 Q 127 50 120 52 Q 110 52 100 50" fill="#5ed68a" stroke="#22543d" stroke-width="1.5"/>
                                    <path d="M 100 50 Q 117 52 123 55 Q 123 62 117 62 Q 107 58 100 50" fill="#86efac" stroke="#22543d" stroke-width="1.5"/>
                                    <!-- Secondary feathers (shorter) -->
                                    <path d="M 100 50 Q 113 58 117 65 Q 115 70 109 68 Q 103 62 100 50" fill="#a0f0c0" stroke="#22543d" stroke-width="1"/>
                                </g>
                            </svg>
                        </div>
                        
                        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; position: relative;">
                            <!-- Animated Dollar Icon -->
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #48bb78, #38a169); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3); flex-shrink: 0;">
                                <svg width="24" height="24" viewBox="0 0 24 24" style="animation: swivelDollar 3s ease-in-out infinite;">
                                    <text x="12" y="19" font-size="18" font-weight="bold" fill="white" text-anchor="middle" font-family="Arial, sans-serif">$</text>
                                </svg>
                            </div>
                            <div style="font-weight: 700; color: #86efac; font-size: 1rem; letter-spacing: 0.02em;"> Payment Information</div>
                        </div>
                        
                        <div style="position: relative; padding-left: 0.5rem; border-left: 3px solid rgba(134, 239, 172, 0.3);">
                            <div style="font-size: 0.875rem; color: #cbd5e0; margin-bottom: 0.5rem;"><strong style="color: #86efac;">Status:</strong> Payment Completed</div>
                            ${order.payment_id ? `<div style="font-size: 0.875rem; color: #cbd5e0; margin-bottom: 0.5rem;"><strong style="color: #86efac;">Payment ID:</strong> <span style="font-family: monospace;">${order.payment_id}</span></div>` : ''}
                            ${order.receipt_id ? `<div style="font-size: 0.875rem; color: #cbd5e0;"><strong style="color: #86efac;">Receipt ID:</strong> <span style="font-family: monospace;">${order.receipt_id}</span></div>` : ''}
                        </div>
                    </div>
                    <style>
                        @keyframes swivelDollar {
                            0%, 100% {
                                transform: perspective(400px) rotateY(0deg);
                            }
                            25% {
                                transform: perspective(400px) rotateY(180deg);
                            }
                            50% {
                                transform: perspective(400px) rotateY(360deg);
                            }
                            75% {
                                transform: perspective(400px) rotateY(180deg);
                            }
                        }
                        
                        @keyframes flyingMoney {
                            0%, 100% {
                                transform: translateY(0) translateX(0) rotate(-5deg);
                            }
                            25% {
                                transform: translateY(-3px) translateX(-3px) rotate(0deg);
                            }
                            50% {
                                transform: translateY(0) translateX(0) rotate(5deg);
                            }
                            75% {
                                transform: translateY(3px) translateX(3px) rotate(0deg);
                            }
                        }
                        
                        @keyframes flapWingLeft {
                            0%, 100% {
                                transform: rotateZ(-15deg) scaleY(1) scaleX(1);
                            }
                            50% {
                                transform: rotateZ(-25deg) scaleY(1.1) scaleX(0.98);
                            }
                        }
                        
                        @keyframes flapWingRight {
                            0%, 100% {
                                transform: rotateZ(15deg) scaleY(1) scaleX(1);
                            }
                            50% {
                                transform: rotateZ(25deg) scaleY(1.1) scaleX(0.98);
                            }
                        }
                    </style>
                    ` : ''}
                    
                    ${adminActionsHtml}
                </div>
            `;
            
            // Create or update modal
            let modal = document.getElementById('orderDetailModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'orderDetailModal';
                modal.className = 'modal';
                document.body.appendChild(modal);
            }
            
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3 class="modal-title">${order.order_number || `Order #${order.id}`}</h3>
                        <button class="close-btn" onclick="closeModal('orderDetailModal')">&times;</button>
                    </div>
                    ${modalContent}
                </div>
            `;
            
            modal.classList.add('active');
            modal.onclick = (e) => { if (e.target === modal) modal.classList.remove('active'); };
        }
        
        function generatePaymentId() {
            const timestamp = Date.now().toString().slice(-8);
            const random = Math.random().toString(36).substr(2, 6).toUpperCase();
            return `PAY-${timestamp}-${random}`;
        }
        
        function generateReceiptId() {
            const timestamp = Date.now().toString().slice(-8);
            const random = Math.random().toString(36).substr(2, 8).toUpperCase();
            return `RCP-${timestamp}-${random}`;
        }
        
        async function approvePayment(orderId) {
            // Create payment processing modal
            const processingModal = document.createElement('div');
            processingModal.className = 'modal active';
            processingModal.id = 'paymentProcessingModal';
            processingModal.innerHTML = `
                <div class="modal-content" style="max-width: 450px; text-align: center; background: linear-gradient(135deg, rgba(30, 41, 59, 0.98), rgba(51, 65, 85, 0.98));">
                    <div style="padding: 2.5rem 2rem;">
                        <!-- Payment Gateway Card -->
                        <div style="background: linear-gradient(135deg, #667eea, #764ba2); padding: 1rem; border-radius: 12px; margin-bottom: 1.5rem; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,%3Csvg width=\"40\" height=\"40\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"none\" fill-rule=\"evenodd\"%3E%3Cg fill=\"%23ffffff\" fill-opacity=\"0.05\"%3E%3Cpath d=\"M0 0h20v20H0V0zm20 20h20v20H20V20z\"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E'); opacity: 0.3;"></div>
                            <div style="position: relative; display: flex; align-items: center; justify-content: space-between; color: white;">
                                <div style="font-size: 0.875rem; font-weight: 600; letter-spacing: 0.5px;">SECURE PAYMENT</div>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                    <rect x="3" y="7" width="18" height="13" rx="2"/>
                                    <path d="M8 7V5a4 4 0 0 1 8 0v2"/>
                                </svg>
                            </div>
                        </div>
                        
                        <!-- Animated Card Icon -->
                        <div style="margin: 2rem auto; position: relative; width: 120px; height: 80px;">
                            <svg width="120" height="80" viewBox="0 0 120 80" style="filter: drop-shadow(0 10px 25px rgba(102, 126, 234, 0.3));">
                                <rect x="10" y="10" width="100" height="60" rx="8" fill="url(#cardGradient)" stroke="rgba(255,255,255,0.2)" stroke-width="2"/>
                                <rect x="10" y="25" width="100" height="12" fill="rgba(0,0,0,0.3)"/>
                                <rect x="20" y="45" width="35" height="8" rx="2" fill="rgba(255,255,255,0.4)"/>
                                <rect x="20" y="58" width="25" height="6" rx="2" fill="rgba(255,255,255,0.3)"/>
                                <circle cx="90" cy="55" r="8" fill="rgba(255,255,255,0.4)" opacity="0.8"/>
                                <circle cx="98" cy="55" r="8" fill="rgba(255,255,255,0.4)" opacity="0.8"/>
                                <defs>
                                    <linearGradient id="cardGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <animate attributeName="x1" values="0%;100%;0%" dur="2s" repeatCount="indefinite"/>
                                        <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                            </svg>
                            <div class="payment-loader" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100px; height: 100px; border: 3px solid rgba(255,255,255,0.1); border-top-color: #60a5fa; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        </div>
                        
                        <div style="font-size: 1.25rem; font-weight: 600; color: #f1f5f9; margin-bottom: 0.5rem; margin-top: 1.5rem;">Processing Payment</div>
                        <div style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 1.5rem;">Securely connecting to payment gateway...</div>
                        
                        <!-- Progress steps -->
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-top: 1rem;">
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: #60a5fa; animation: pulse 1.5s ease-in-out infinite;"></div>
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: #60a5fa; animation: pulse 1.5s ease-in-out infinite 0.2s;"></div>
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: #60a5fa; animation: pulse 1.5s ease-in-out infinite 0.4s;"></div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(processingModal);
            
            // Add animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin { to { transform: rotate(360deg); } }
                @keyframes pulse {
                    0%, 100% { opacity: 0.3; transform: scale(0.8); }
                    50% { opacity: 1; transform: scale(1.2); }
                }
            `;
            document.head.appendChild(style);
            
            try {
                // Simulate payment gateway processing delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Update to "Authorizing"
                processingModal.querySelector('.modal-content').innerHTML = `
                    <div style="padding: 2.5rem 2rem;">
                        <!-- Security Shield Animation -->
                        <div style="margin: 2rem auto; position: relative; width: 100px; height: 100px;">
                            <svg width="100" height="100" viewBox="0 0 100 100">
                                <defs>
                                    <linearGradient id="shieldGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#48bb78;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#38a169;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <path d="M50 10 L80 25 L80 50 Q80 75 50 90 Q20 75 20 50 L20 25 Z" 
                                      fill="url(#shieldGradient)" 
                                      stroke="rgba(72, 187, 120, 0.5)" 
                                      stroke-width="2"
                                      style="filter: drop-shadow(0 10px 25px rgba(72, 187, 120, 0.4));"/>
                                <path d="M40 50 L47 57 L62 42" 
                                      stroke="white" 
                                      stroke-width="4" 
                                      fill="none" 
                                      stroke-linecap="round" 
                                      stroke-linejoin="round"
                                      style="animation: checkmark 0.5s ease-in-out forwards;"/>
                            </svg>
                            <div class="payment-loader" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 110px; height: 110px; border: 3px solid rgba(72, 187, 120, 0.2); border-top-color: #48bb78; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        </div>
                        
                        <div style="font-size: 1.25rem; font-weight: 600; color: #f1f5f9; margin-bottom: 0.5rem; margin-top: 1.5rem;">Authorizing Transaction</div>
                        <div style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 1.5rem;">Verifying payment details with bank...</div>
                        
                        <div style="display: flex; gap: 0.5rem; justify-content: center;">
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: #48bb78; animation: pulse 1.5s ease-in-out infinite;"></div>
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: #48bb78; animation: pulse 1.5s ease-in-out infinite 0.2s;"></div>
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: #48bb78; animation: pulse 1.5s ease-in-out infinite 0.4s;"></div>
                        </div>
                    </div>
                `;
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Generate payment and receipt IDs
                const paymentId = generatePaymentId();
                const receiptId = generateReceiptId();
                const transactionTime = new Date().toLocaleString();
                
                // Make the actual API call
                const response = await fetch(`/api/orders/${orderId}/payment`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Basic ${authCredentials}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        action: 'approve',
                        payment_id: paymentId,
                        receipt_id: receiptId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show success with details
                    processingModal.querySelector('.modal-content').innerHTML = `
                        <div style="padding: 2.5rem 2rem;">
                            <!-- Success Animation -->
                            <div style="margin: 1.5rem auto; position: relative; width: 120px; height: 120px;">
                                <svg width="120" height="120" viewBox="0 0 120 120">
                                    <circle cx="60" cy="60" r="54" fill="none" stroke="#48bb78" stroke-width="4" opacity="0.2"/>
                                    <circle cx="60" cy="60" r="54" fill="none" stroke="#48bb78" stroke-width="4" 
                                            stroke-dasharray="339.292" stroke-dashoffset="339.292"
                                            style="animation: drawCircle 0.6s ease-out forwards;"/>
                                    <circle cx="60" cy="60" r="50" fill="#48bb78" opacity="0.1"/>
                                    <path d="M45 60 L55 70 L78 47" 
                                          stroke="#48bb78" 
                                          stroke-width="6" 
                                          fill="none" 
                                          stroke-linecap="round" 
                                          stroke-linejoin="round"
                                          stroke-dasharray="50" 
                                          stroke-dashoffset="50"
                                          style="animation: drawCheck 0.4s 0.6s ease-out forwards;"/>
                                </svg>
                                <style>
                                    @keyframes drawCircle {
                                        to { stroke-dashoffset: 0; }
                                    }
                                    @keyframes drawCheck {
                                        to { stroke-dashoffset: 0; }
                                    }
                                </style>
                            </div>
                            <div style="font-size: 1.5rem; font-weight: 700; color: #86efac; margin-bottom: 0.5rem;">Payment Successful!</div>
                            <div style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 2rem;">Your transaction has been processed securely</div>
                            
                            <div style="background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 8px; padding: 1.5rem; margin: 1.5rem 0; text-align: left;">
                                <div style="font-weight: 600; color: #f1f5f9; margin-bottom: 1rem; font-size: 1rem;">Transaction Details</div>
                                
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid rgba(100, 116, 139, 0.3);">
                                    <span style="color: #94a3b8; font-size: 0.875rem;">Payment ID</span>
                                    <span style="color: #e2e8f0; font-weight: 600; font-size: 0.875rem; font-family: monospace;">${paymentId}</span>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid rgba(100, 116, 139, 0.3);">
                                    <span style="color: #94a3b8; font-size: 0.875rem;">Receipt ID</span>
                                    <span style="color: #e2e8f0; font-weight: 600; font-size: 0.875rem; font-family: monospace;">${receiptId}</span>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid rgba(100, 116, 139, 0.3);">
                                    <span style="color: #94a3b8; font-size: 0.875rem;">Order ID</span>
                                    <span style="color: #e2e8f0; font-weight: 600; font-size: 0.875rem;">#${orderId}</span>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid rgba(100, 116, 139, 0.3);">
                                    <span style="color: #94a3b8; font-size: 0.875rem;">Transaction Time</span>
                                    <span style="color: #e2e8f0; font-weight: 600; font-size: 0.875rem;">${transactionTime}</span>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; padding: 0.75rem 0;">
                                    <span style="color: #94a3b8; font-size: 0.875rem;">Status</span>
                                    <span style="color: #86efac; font-weight: 700; font-size: 0.875rem;">COMPLETED</span>
                                </div>
                            </div>
                            
                            <button onclick="document.getElementById('paymentProcessingModal').remove(); loadOrders(); closeModal('orderDetailModal');" 
                                    style="width: 100%; padding: 1rem; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1rem; margin-top: 1rem;">
                                Continue
                            </button>
                        </div>
                    `;
                } else {
                    throw new Error(result.error || 'Payment approval failed');
                }
            } catch (error) {
                // Show error state
                processingModal.querySelector('.modal-content').innerHTML = `
                    <div style="padding: 2rem;">
                        <div style="width: 80px; height: 80px; margin: 0 auto 1.5rem; background: #f56565; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </div>
                        <div style="font-size: 1.5rem; font-weight: 700; color: #f56565; margin-bottom: 0.5rem;">Payment Failed</div>
                        <div style="font-size: 0.9rem; color: #94a3b8; margin-bottom: 1.5rem;">${error.message}</div>
                        
                        <button onclick="document.getElementById('paymentProcessingModal').remove();" 
                                style="width: 100%; padding: 1rem; background: #4a5568; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1rem;">
                            Close
                        </button>
                    </div>
                `;
            }
        }
        
        async function declinePayment(orderId) {
            if (!confirm(`Decline payment for order #${orderId}? This will cancel the order.`)) return;
            
            try {
                const response = await fetch(`/api/orders/${orderId}/payment`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Basic ${authCredentials}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ action: 'decline' })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert(result.message);
                    loadOrders();
                    closeModal('orderDetailModal');
                } else {
                    alert('Failed to decline payment');
                }
            } catch (error) {
                alert('Error processing payment');
            }
        }
        
        async function updateOrderStatus(orderId, newStatus) {
            const statusMessages = {
                'PROCESSING': 'start processing',
                'SHIPPED': 'mark as shipped',
                'DELIVERED': 'mark as delivered'
            };
            
            if (!confirm(`Are you sure you want to ${statusMessages[newStatus] || 'update'} order #${orderId}?`)) return;
            
            try {
                const response = await fetch(`/api/orders/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Basic ${authCredentials}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ order_status: newStatus })
                });
                
                const result = await response.json();
                if (result.success) {
                    alert(`Order #${orderId} status updated to ${newStatus}`);
                    loadOrders();
                    closeModal('orderDetailModal');
                } else {
                    alert('Failed to update order status: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Error updating order status: ' + error.message);
            }
        }

        // Close modals when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });

        // Initialize city dropdown for create form on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateCityOptions('create');
        });
        
        // Scroll to top functionality
        window.addEventListener('scroll', () => {
            const scrollButton = document.getElementById('scrollToTopBtn');
            if (window.pageYOffset > 300) {
                scrollButton.classList.add('visible');
            } else {
                scrollButton.classList.remove('visible');
            }
        });
        
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // Activity Logs Drawer Functions
        let drawerWs = null;
        let drawerStreaming = false;
        let lastDrawerLogId = 0;
        
        function toggleLogsDrawer() {
            const drawer = document.getElementById('logsDrawer');
            drawer.classList.toggle('active');
            
            if (drawer.classList.contains('active')) {
                fetchDrawerLogs();
                fetchDrawerStats();
                // Reset badge
                const badge = document.getElementById('logsHeaderBadge');
                badge.classList.remove('visible');
                badge.textContent = '0';
                
                // Show Clear button for admins
                const userRole = document.getElementById('userRole').textContent;
                if (userRole === 'ADMIN') {
                    document.getElementById('clearLogsBtn').style.display = 'flex';
                }
            }
            // Note: We keep stream running even when closed so it continues collecting logs
        }
        
        async function fetchDrawerLogs() {
            const eventFilter = document.getElementById('drawerEventFilter').value;
            const entityFilter = document.getElementById('drawerEntityFilter').value;
            
            const params = new URLSearchParams();
            if (eventFilter) params.append('event_type', eventFilter);
            if (entityFilter) params.append('entity_type', entityFilter);
            params.append('limit', '50');
            
            try {
                const response = await fetch(`/api/logs?${params}`, {
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                if (response.status === 401) {
                    showDrawerAuthError();
                    return;
                }
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();
                const logs = Array.isArray(data.logs) ? data.logs : [];
                displayDrawerLogs(logs);
                
                // Update last log ID for streaming
                if (logs.length > 0) {
                    lastDrawerLogId = Math.max(...logs.map(l => l.id));
                }
            } catch (error) {
                console.error('Error fetching logs:', error);
                document.getElementById('drawerLogsList').innerHTML = `
                    <div class="logs-loading" style="text-align:center;">
                        <div style="margin-bottom:8px;">Unable to load logs.</div>
                        <button onclick="fetchDrawerLogs()" style="padding:6px 12px; background: rgba(102,126,234,.2); border: 1px solid rgba(102,126,234,.3); border-radius: 6px; color: #a5b4fc; cursor: pointer;">Retry</button>
                    </div>`;
            }
        }
        
        function displayDrawerLogs(logs) {
            const container = document.getElementById('drawerLogsList');
            
            if (logs.length === 0) {
                container.innerHTML = `
                    <div class="logs-loading">
                        <div style="font-size: 2rem; margin-bottom: 12px;"></div>
                        <div style="margin-bottom: 8px;">No activity logs yet</div>
                        <div style="font-size: 0.875rem; color: #64748b;">
                            Perform actions in the dashboard to see logs here.<br>
                            Try creating a customer, product, or order.
                        </div>
                        <div style="margin-top: 16px;">
                            <button onclick="toggleDrawerStream()" style="padding: 8px 16px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #a5b4fc; cursor: pointer;">
                                Start Live Stream to capture new events
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = logs.map(log => `
                <div class="log-item" onclick="toggleLogDetails(${log.id})">
                    <div class="log-item-header">
                        <div class="log-item-main">
                            <span class="log-event-badge ${log.event_type}">${log.event_type}</span>
                            <div class="log-entity">${log.entity_type} #${log.entity_id || 'N/A'}</div>
                            <div class="log-description">${log.description || 'No description'}</div>
                        </div>
                        <div class="log-time">${formatLogTime(log.timestamp)}</div>
                    </div>
                    <div class="log-item-details" id="log-details-${log.id}">
                        <div><strong>User:</strong> ${log.user_id || 'System'}</div>
                        <div><strong>Time:</strong> ${new Date(log.timestamp).toLocaleString()}</div>
                        ${log.metadata ? `<div><strong>Metadata:</strong> <pre style="margin-top:6px;">${JSON.stringify(log.metadata, null, 2)}</pre></div>` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function showDrawerAuthError() {
            const container = document.getElementById('drawerLogsList');
            container.innerHTML = `
                <div class="logs-loading" style="text-align:center;">
                    <div style="margin-bottom:8px;">Session expired. Please sign in again.</div>
                    <button onclick="logout()" style="padding:6px 12px; background: rgba(248, 113, 113, 0.2); border: 1px solid rgba(248, 113, 113, 0.3); border-radius: 6px; color: #fca5a5; cursor: pointer;">Logout</button>
                </div>
            `;
        }
        
        function prependDrawerLogs(logs) {
            const container = document.getElementById('drawerLogsList');
            const html = logs.map(log => `
                <div class="log-item" onclick="toggleLogDetails(${log.id})" style="animation: slideInRight 0.3s ease-out;">
                    <div class="log-item-header">
                        <div class="log-item-main">
                            <span class="log-event-badge ${log.event_type}">${log.event_type}</span>
                            <div class="log-entity">${log.entity_type} #${log.entity_id || 'N/A'}</div>
                            <div class="log-description">${log.description || 'No description'}</div>
                        </div>
                        <div class="log-time">${formatLogTime(log.timestamp)}</div>
                    </div>
                    <div class="log-item-details" id="log-details-${log.id}">
                        <div><strong>User:</strong> ${log.user_id || 'System'}</div>
                        <div><strong>Time:</strong> ${new Date(log.timestamp).toLocaleString()}</div>
                        ${log.metadata ? `<div><strong>Metadata:</strong> <pre style="margin-top:6px;">${JSON.stringify(log.metadata, null, 2)}</pre></div>` : ''}
                    </div>
                </div>
            `).join('');
            container.insertAdjacentHTML('afterbegin', html);
            
            // Update badge if drawer is closed
            const drawer = document.getElementById('logsDrawer');
            if (!drawer.classList.contains('active')) {
                const badge = document.getElementById('logsHeaderBadge');
                const currentCount = parseInt(badge.textContent) || 0;
                const newCount = currentCount + logs.length;
                badge.textContent = newCount > 99 ? '99+' : newCount;
                badge.classList.add('visible');
            }
        }
        
        function toggleLogDetails(logId) {
            const details = document.getElementById(`log-details-${logId}`);
            if (details) {
                details.classList.toggle('expanded');
            }
        }
        
        function formatLogTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);
            
            if (diff < 60) return `${diff}s ago`;
            if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
            return date.toLocaleDateString();
        }
        
        async function fetchDrawerStats() {
            try {
                const response = await fetch('/api/logs/stats', {
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                const data = await response.json();
                
                document.getElementById('drawerTotalLogs').textContent = data.total_logs.toLocaleString();
                document.getElementById('drawerRecent24h').textContent = data.recent_24h.toLocaleString();
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }
        
        function toggleDrawerStream() {
            if (drawerStreaming) {
                stopDrawerStream();
            } else {
                startDrawerStream();
            }
        }
        
        function startDrawerStream() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            drawerWs = new WebSocket(`${protocol}//${window.location.host}/ws/logs`);
            
            drawerWs.onopen = () => {
                drawerStreaming = true;
                const btn = document.getElementById('drawerStreamBtn');
                btn.classList.add('streaming');
                document.getElementById('streamBtnText').textContent = 'Live';
            };
            
            drawerWs.onmessage = (event) => {
                const message = JSON.parse(event.data);
                if (message.type === 'logs' && message.data.length > 0) {
                    prependDrawerLogs(message.data);
                    lastDrawerLogId = Math.max(...message.data.map(l => l.id), lastDrawerLogId);
                    fetchDrawerStats();
                }
            };
            
            drawerWs.onerror = (error) => {
                console.error('WebSocket error:', error);
                stopDrawerStream();
            };
            
            drawerWs.onclose = () => {
                stopDrawerStream();
            };
        }
        
        function stopDrawerStream() {
            if (drawerWs) {
                drawerWs.close();
                drawerWs = null;
            }
            drawerStreaming = false;
            const btn = document.getElementById('drawerStreamBtn');
            btn.classList.remove('streaming');
            document.getElementById('streamBtnText').textContent = 'Live';
        }
        
        function exportDrawerLogs() {
            const eventFilter = document.getElementById('drawerEventFilter').value;
            const entityFilter = document.getElementById('drawerEntityFilter').value;
            
            const params = new URLSearchParams();
            if (eventFilter) params.append('event_type', eventFilter);
            if (entityFilter) params.append('entity_type', entityFilter);
            params.append('format', 'csv');
            
            window.open(`/api/logs/export?${params}`, '_blank');
        }
        
        async function clearAllLogs() {
            if (!confirm(' This will permanently delete ALL activity logs. This action cannot be undone.\n\nAre you sure you want to continue?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/logs/clear', {
                    method: 'DELETE',
                    headers: { 'Authorization': `Basic ${authCredentials}` }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(` Successfully cleared ${data.deleted_count} log entries`);
                    fetchDrawerLogs();
                    fetchDrawerStats();
                } else {
                    alert('Failed to clear logs: ' + (data.error || 'Unknown error'));
                }
            } catch (error) {
                alert('Error clearing logs: ' + error.message);
            }
        }
        
        // Initialize logs on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Fetch stats periodically to update badge
            setInterval(async () => {
                if (!document.getElementById('logsDrawer').classList.contains('active')) {
                    try {
                        const response = await fetch('/api/logs/stats', {
                            headers: { 'Authorization': `Basic ${authCredentials}` }
                        });
                        const data = await response.json();
                        
                        // Update badge based on recent activity
                        if (data.recent_24h > 0 && lastDrawerLogId === 0) {
                            const badge = document.getElementById('logsHeaderBadge');
                            badge.textContent = data.recent_24h > 99 ? '99+' : data.recent_24h;
                            badge.classList.add('visible');
                        }
                    } catch (error) {
                        console.error('Error fetching log stats:', error);
                    }
                }
            }, 30000); // Every 30 seconds
        });
    </script>
    
    <!-- Scroll to Top Button -->
    <div id="scrollToTopBtn" class="scroll-to-top" onclick="scrollToTop()" title="Back to Top">
        <svg viewBox="0 0 24 24" fill="none">
            <path d="M12 19V5M12 5l-7 7M12 5l7 7"/>
        </svg>
    </div>
    
    <!-- Logs Drawer -->
    <div id="logsDrawer" class="logs-drawer">
        <div class="logs-drawer-overlay" onclick="toggleLogsDrawer()"></div>
        <div class="logs-drawer-content">
            <!-- Header -->
            <div class="logs-drawer-header">
                <div>
                    <h2>Activity Logs</h2>
                    <p>Real-time system activity trail</p>
                </div>
                <button class="logs-close-btn" onclick="toggleLogsDrawer()">&times;</button>
            </div>
            
            <!-- Controls -->
            <div class="logs-controls">
                <div class="logs-filters">
                    <select id="drawerEventFilter" onchange="fetchDrawerLogs()">
                        <option value="">All Events</option>
                        <option value="CREATE">CREATE</option>
                        <option value="UPDATE">UPDATE</option>
                        <option value="DELETE">DELETE</option>
                        <option value="PAYMENT">PAYMENT</option>
                    </select>
                    
                    <select id="drawerEntityFilter" onchange="fetchDrawerLogs()">
                        <option value="">All Entities</option>
                        <option value="order">Order</option>
                        <option value="customer">Customer</option>
                        <option value="product">Product</option>
                        <option value="shipment">Shipment</option>
                        <option value="payment">Payment</option>
                    </select>
                </div>
                
                <div class="logs-actions">
                    <button class="logs-stream-btn" id="drawerStreamBtn" onclick="toggleDrawerStream()">
                        <span class="stream-dot"></span>
                        <span id="streamBtnText">Live</span>
                    </button>
                    <button class="logs-export-btn" onclick="exportDrawerLogs()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7 10 12 15 17 10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Export
                    </button>
                    <button class="logs-clear-btn" id="clearLogsBtn" onclick="clearAllLogs()" style="display: none;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        Clear
                    </button>
                </div>
            </div>
            
            <!-- Stats -->
            <div class="logs-stats">
                <div class="logs-stat">
                    <span class="stat-value" id="drawerTotalLogs">0</span>
                    <span class="stat-label">Total</span>
                </div>
                <div class="logs-stat">
                    <span class="stat-value" id="drawerRecent24h">0</span>
                    <span class="stat-label">Last 24h</span>
                </div>
            </div>
            
            <!-- Logs List -->
            <div class="logs-list" id="drawerLogsList">
                <div class="logs-loading">Loading logs...</div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="dashboard-footer">
        <div class="footer-content">
             2025 Group 36 - Scalable Services Assignment
        </div>
    </footer>
    
    <style>
        .dashboard-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(100, 116, 139, 0.2);
            z-index: 40;
            pointer-events: none;
        }
        
        .footer-content {
            padding: 0.75rem 2rem;
            text-align: center;
            font-size: 0.75rem;
            color: #94a3b8;
            font-weight: 500;
            letter-spacing: 0.025em;
        }
        
        /* Add padding to dashboard container to prevent overlap */
        #dashboardContainer {
            padding-bottom: 50px;
        }
        
        /* Activity Logs Header Button */
        .logs-header-btn {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #a5b4fc;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            font-size: 0.875rem;
        }
        
        .logs-header-btn:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .logs-header-btn svg {
            flex-shrink: 0;
        }
        
        .logs-header-badge {
            background: #ef4444;
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            display: none;
        }
        
        .logs-header-badge.visible {
            display: inline-block;
            animation: badgePop 0.3s ease-out;
        }
        
        @keyframes badgePop {
            0% { transform: scale(0); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        /* Logs Drawer */
        .logs-drawer {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            z-index: 2000;
            display: none;
        }
        
        .logs-drawer.active {
            display: block;
        }
        
        .logs-drawer-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .logs-drawer-content {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 500px;
            max-width: 90vw;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            box-shadow: -8px 0 32px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }
        
        .logs-drawer-header {
            padding: 24px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            background: rgba(15, 23, 42, 0.6);
        }
        
        .logs-drawer-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f1f5f9;
            margin: 0 0 4px 0;
        }
        
        .logs-drawer-header p {
            font-size: 0.875rem;
            color: #94a3b8;
            margin: 0;
        }
        
        .logs-close-btn {
            background: rgba(248, 113, 113, 0.2);
            border: 1px solid rgba(248, 113, 113, 0.3);
            color: #fca5a5;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .logs-close-btn:hover {
            background: rgba(248, 113, 113, 0.3);
        }
        
        .logs-controls {
            padding: 16px 24px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .logs-filters {
            display: flex;
            gap: 8px;
            flex: 1;
            min-width: 200px;
        }
        
        .logs-filters select {
            flex: 1;
            padding: 8px 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 8px;
            color: #e2e8f0;
            font-size: 0.875rem;
            cursor: pointer;
        }
        
        .logs-actions {
            display: flex;
            gap: 8px;
        }
        
        .logs-stream-btn, .logs-export-btn, .logs-clear-btn {
            padding: 8px 12px;
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            color: #a5b4fc;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        
        .logs-stream-btn:hover, .logs-export-btn:hover, .logs-clear-btn:hover {
            background: rgba(102, 126, 234, 0.3);
        }
        
        .logs-clear-btn {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.3);
            color: #fca5a5;
        }
        
        .logs-clear-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }
        
        .logs-stream-btn.streaming {
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.3);
            color: #86efac;
        }
        
        .stream-dot {
            width: 8px;
            height: 8px;
            background: #a5b4fc;
            border-radius: 50%;
        }
        
        .logs-stream-btn.streaming .stream-dot {
            background: #86efac;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .logs-stats {
            padding: 16px 24px;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
            display: flex;
            gap: 24px;
        }
        
        .logs-stat {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .logs-list {
            flex: 1;
            overflow-y: auto;
            padding: 16px 24px;
        }
        
        .logs-loading {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
            font-weight: 600;
        }
        
        .log-item {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(100, 116, 139, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .log-item:hover {
            background: rgba(15, 23, 42, 0.8);
            border-color: rgba(102, 126, 234, 0.3);
        }
        
        .log-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .log-item-main {
            flex: 1;
            min-width: 0;
        }
        
        .log-event-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 6px;
        }
        
        .log-event-badge.CREATE { background: rgba(34, 197, 94, 0.2); color: #86efac; }
        .log-event-badge.UPDATE { background: rgba(59, 130, 246, 0.2); color: #93c5fd; }
        .log-event-badge.DELETE { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
        .log-event-badge.PAYMENT { background: rgba(245, 158, 11, 0.2); color: #fcd34d; }
        
        .log-entity {
            font-weight: 600;
            color: #f1f5f9;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
        
        .log-description {
            font-size: 0.875rem;
            color: #cbd5e0;
        }
        
        .log-time {
            font-size: 0.75rem;
            color: #64748b;
            white-space: nowrap;
        }
        
        .log-item-details {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(100, 116, 139, 0.2);
            display: none;
            font-size: 0.875rem;
            color: #94a3b8;
        }
        
        .log-item-details.expanded {
            display: block;
        }
        
        .log-item-details div {
            margin-bottom: 6px;
        }
        
        .log-item-details strong {
            color: #cbd5e0;
        }
    </style>
</body>
</html>
